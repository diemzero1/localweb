{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { get, keys } from '@antv/util';\nimport { animation as commonAnimation, interaction as commonInteraction, limitInPlot as commonLimitInPlot, scale, theme as commonTheme, tooltip } from '../../adaptor/common';\nimport { interval } from '../../adaptor/geometries';\nimport { deepAssign, findGeometry, findViewById, flow, transformLabel } from '../../utils';\nimport { FIRST_AXES_VIEW, SECOND_AXES_VIEW, SERIES_FIELD_KEY } from './constant';\nimport { isHorizontal, transformData } from './utils';\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var data = options.data,\n    xField = options.xField,\n    yField = options.yField,\n    color = options.color,\n    barStyle = options.barStyle,\n    widthRatio = options.widthRatio,\n    legend = options.legend,\n    layout = options.layout;\n  // 处理数据\n  var groupData = transformData(xField, yField, SERIES_FIELD_KEY, data, isHorizontal(layout));\n  // 在创建子 view 执行后不行，需要在前面处理 legend\n  if (legend) {\n    chart.legend(SERIES_FIELD_KEY, legend);\n  } else if (legend === false) {\n    chart.legend(false);\n  }\n  // 创建 view\n  var firstView;\n  var secondView;\n  var firstViewData = groupData[0],\n    secondViewData = groupData[1];\n  // 横向\n  if (isHorizontal(layout)) {\n    firstView = chart.createView({\n      region: {\n        start: {\n          x: 0,\n          y: 0\n        },\n        end: {\n          x: 0.5,\n          y: 1\n        }\n      },\n      id: FIRST_AXES_VIEW\n    });\n    firstView.coordinate().transpose().reflect('x');\n    secondView = chart.createView({\n      region: {\n        start: {\n          x: 0.5,\n          y: 0\n        },\n        end: {\n          x: 1,\n          y: 1\n        }\n      },\n      id: SECOND_AXES_VIEW\n    });\n    secondView.coordinate().transpose();\n    // @说明: 测试发现，横向因为轴的反转，需要数据也反转，不然会图形渲染是反的(翻转操作进入到 transform 中处理)\n    firstView.data(firstViewData);\n    secondView.data(secondViewData);\n  } else {\n    // 纵向\n    firstView = chart.createView({\n      region: {\n        start: {\n          x: 0,\n          y: 0\n        },\n        end: {\n          x: 1,\n          y: 0.5\n        }\n      },\n      id: FIRST_AXES_VIEW\n    });\n    secondView = chart.createView({\n      region: {\n        start: {\n          x: 0,\n          y: 0.5\n        },\n        end: {\n          x: 1,\n          y: 1\n        }\n      },\n      id: SECOND_AXES_VIEW\n    });\n    secondView.coordinate().reflect('y');\n    firstView.data(firstViewData);\n    secondView.data(secondViewData);\n  }\n  var left = deepAssign({}, params, {\n    chart: firstView,\n    options: {\n      widthRatio: widthRatio,\n      xField: xField,\n      yField: yField[0],\n      seriesField: SERIES_FIELD_KEY,\n      interval: {\n        color: color,\n        style: barStyle\n      }\n    }\n  });\n  interval(left);\n  var right = deepAssign({}, params, {\n    chart: secondView,\n    options: {\n      xField: xField,\n      yField: yField[1],\n      seriesField: SERIES_FIELD_KEY,\n      widthRatio: widthRatio,\n      interval: {\n        color: color,\n        style: barStyle\n      }\n    }\n  });\n  interval(right);\n  return params;\n}\n/**\n * meta 配置\n * - 对称条形图对数据进行了处理，通过 SERIES_FIELD_KEY 来对两条 yField 数据进行分类\n * @param params\n */\nfunction meta(params) {\n  var _a, _b, _c;\n  var options = params.options,\n    chart = params.chart;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField;\n  var firstView = findViewById(chart, FIRST_AXES_VIEW);\n  var secondView = findViewById(chart, SECOND_AXES_VIEW);\n  var aliasMap = {};\n  keys((options === null || options === void 0 ? void 0 : options.meta) || {}).map(function (metaKey) {\n    if (get(options === null || options === void 0 ? void 0 : options.meta, [metaKey, 'alias'])) {\n      aliasMap[metaKey] = options.meta[metaKey].alias;\n    }\n  });\n  chart.scale((_a = {}, _a[SERIES_FIELD_KEY] = {\n    sync: true,\n    formatter: function (v) {\n      return get(aliasMap, v, v);\n    }\n  }, _a));\n  scale((_b = {}, _b[xField] = xAxis, _b[yField[0]] = yAxis[yField[0]], _b))(deepAssign({}, params, {\n    chart: firstView\n  }));\n  scale((_c = {}, _c[xField] = xAxis, _c[yField[1]] = yAxis[yField[1]], _c))(deepAssign({}, params, {\n    chart: secondView\n  }));\n  return params;\n}\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis,\n    xField = options.xField,\n    yField = options.yField,\n    layout = options.layout;\n  var firstView = findViewById(chart, FIRST_AXES_VIEW);\n  var secondView = findViewById(chart, SECOND_AXES_VIEW);\n  // 第二个 view axis 始终隐藏; 注意 bottom 的时候，只隐藏 label，其他共用配置\n  // @ts-ignore\n  if ((xAxis === null || xAxis === void 0 ? void 0 : xAxis.position) === 'bottom') {\n    // fixme 直接设置 label: null 会导致 tickLine 无法显示\n    secondView.axis(xField, __assign(__assign({}, xAxis), {\n      label: {\n        formatter: function () {\n          return '';\n        }\n      }\n    }));\n  } else {\n    secondView.axis(xField, false);\n  }\n  // 为 false 则是不显示 firstView 轴\n  if (xAxis === false) {\n    firstView.axis(xField, false);\n  } else {\n    firstView.axis(xField, __assign({\n      // 不同布局 firstView 的坐标轴显示位置\n      position: isHorizontal(layout) ? 'top' : 'bottom'\n    }, xAxis));\n  }\n  if (yAxis === false) {\n    firstView.axis(yField[0], false);\n    secondView.axis(yField[1], false);\n  } else {\n    firstView.axis(yField[0], yAxis[yField[0]]);\n    secondView.axis(yField[1], yAxis[yField[1]]);\n  }\n  /**\n   *  这个注入，主要是在syncViewPadding时候拿到相对应的配置：布局和轴的位置\n   *  TODO 之后希望 g2 View 对象可以开放 setter 可以设置一些需要的东西\n   */\n  //@ts-ignore\n  chart.__axisPosition = {\n    position: firstView.getOptions().axes[xField].position,\n    layout: layout\n  };\n  return params;\n}\n/**\n * interaction 配置\n * @param params\n */\nexport function interaction(params) {\n  var chart = params.chart;\n  commonInteraction(deepAssign({}, params, {\n    chart: findViewById(chart, FIRST_AXES_VIEW)\n  }));\n  commonInteraction(deepAssign({}, params, {\n    chart: findViewById(chart, SECOND_AXES_VIEW)\n  }));\n  return params;\n}\n/**\n * limitInPlot\n * @param params\n */\nexport function limitInPlot(params) {\n  var chart = params.chart,\n    options = params.options;\n  var yField = options.yField,\n    yAxis = options.yAxis;\n  commonLimitInPlot(deepAssign({}, params, {\n    chart: findViewById(chart, FIRST_AXES_VIEW),\n    options: {\n      yAxis: yAxis[yField[0]]\n    }\n  }));\n  commonLimitInPlot(deepAssign({}, params, {\n    chart: findViewById(chart, SECOND_AXES_VIEW),\n    options: {\n      yAxis: yAxis[yField[1]]\n    }\n  }));\n  return params;\n}\n/**\n * theme\n * @param params\n */\nexport function theme(params) {\n  var chart = params.chart;\n  commonTheme(deepAssign({}, params, {\n    chart: findViewById(chart, FIRST_AXES_VIEW)\n  }));\n  commonTheme(deepAssign({}, params, {\n    chart: findViewById(chart, SECOND_AXES_VIEW)\n  }));\n  commonTheme(params);\n  return params;\n}\n/**\n * animation\n * @param params\n */\nexport function animation(params) {\n  var chart = params.chart;\n  commonAnimation(deepAssign({}, params, {\n    chart: findViewById(chart, FIRST_AXES_VIEW)\n  }));\n  commonAnimation(deepAssign({}, params, {\n    chart: findViewById(chart, SECOND_AXES_VIEW)\n  }));\n  return params;\n}\n/**\n * label 配置 (1. 设置 offset 偏移量默认值 2. leftView 偏移量需要 *= -1)\n * @param params\n */\nfunction label(params) {\n  var _this = this;\n  var _a, _b;\n  var chart = params.chart,\n    options = params.options;\n  var label = options.label,\n    yField = options.yField,\n    layout = options.layout;\n  var firstView = findViewById(chart, FIRST_AXES_VIEW);\n  var secondView = findViewById(chart, SECOND_AXES_VIEW);\n  var leftGeometry = findGeometry(firstView, 'interval');\n  var rightGeometry = findGeometry(secondView, 'interval');\n  if (!label) {\n    leftGeometry.label(false);\n    rightGeometry.label(false);\n  } else {\n    var callback = label.callback,\n      cfg_1 = __rest(label, [\"callback\"]);\n    /** ---- 设置默认配置 ---- */\n    // 默认居中\n    if (!cfg_1.position) {\n      cfg_1.position = 'middle';\n    }\n    if (cfg_1.offset === undefined) {\n      cfg_1.offset = 2;\n    }\n    /** ---- leftView label 设置 ---- */\n    var leftLabelCfg = __assign({}, cfg_1);\n    if (isHorizontal(layout)) {\n      // 设置 textAlign 默认值\n      var textAlign = ((_a = leftLabelCfg.style) === null || _a === void 0 ? void 0 : _a.textAlign) || (cfg_1.position === 'middle' ? 'center' : 'left');\n      cfg_1.style = deepAssign({}, cfg_1.style, {\n        textAlign: textAlign\n      });\n      var textAlignMap = {\n        left: 'right',\n        right: 'left',\n        center: 'center'\n      };\n      leftLabelCfg.style = deepAssign({}, leftLabelCfg.style, {\n        textAlign: textAlignMap[textAlign]\n      });\n    } else {\n      var positionMap_1 = {\n        top: 'bottom',\n        bottom: 'top',\n        middle: 'middle'\n      };\n      if (typeof cfg_1.position === 'string') {\n        cfg_1.position = positionMap_1[cfg_1.position];\n      } else if (typeof cfg_1.position === 'function') {\n        cfg_1.position = function () {\n          var args = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n          return positionMap_1[cfg_1.position.apply(_this, args)];\n        };\n      }\n      // 设置 textBaseline 默认值\n      var textBaseline = ((_b = leftLabelCfg.style) === null || _b === void 0 ? void 0 : _b.textBaseline) || 'bottom';\n      leftLabelCfg.style = deepAssign({}, leftLabelCfg.style, {\n        textBaseline: textBaseline\n      });\n      var textBaselineMap = {\n        top: 'bottom',\n        bottom: 'top',\n        middle: 'middle'\n      };\n      cfg_1.style = deepAssign({}, cfg_1.style, {\n        textBaseline: textBaselineMap[textBaseline]\n      });\n    }\n    leftGeometry.label({\n      fields: [yField[0]],\n      callback: callback,\n      cfg: transformLabel(leftLabelCfg)\n    });\n    rightGeometry.label({\n      fields: [yField[1]],\n      callback: callback,\n      cfg: transformLabel(cfg_1)\n    });\n  }\n  return params;\n}\n/**\n * 对称条形图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(geometry, meta, axis, limitInPlot, theme, label, tooltip, interaction, animation)(params);\n}","map":{"version":3,"mappings":"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","names":["get","keys","animation","commonAnimation","interaction","commonInteraction","limitInPlot","commonLimitInPlot","scale","theme","commonTheme","tooltip","interval","deepAssign","findGeometry","findViewById","flow","transformLabel","FIRST_AXES_VIEW","SECOND_AXES_VIEW","SERIES_FIELD_KEY","isHorizontal","transformData","geometry","params","options","xField","yField","color","barStyle","widthRatio","legend","layout","groupData","data","chart","firstView","secondView","secondViewData","createView","region","start","x","y","end","id","coordinate","transpose","reflect","firstViewData","left","seriesField","style","right","meta","yAxis","aliasMap","map","metaKey","alias","_a","sync","formatter","v","_b","xAxis","_c","axis","position","label","__axisPosition","getOptions","axes","leftGeometry","rightGeometry","cfg_1","offset","undefined","leftLabelCfg","textAlign","textAlignMap","center","positionMap_1","top","bottom","middle","_i","args","apply","_this","textBaseline","textBaselineMap","fields","callback","cfg","adaptor"],"sources":["/home/iam/Documents/LocalWeb-master/node_modules/@antv/g2plot/src/plots/bidirectional-bar/adaptor.ts"],"sourcesContent":["import { View } from '@antv/g2';\nimport { get, keys } from '@antv/util';\nimport {\n  animation as commonAnimation,\n  interaction as commonInteraction,\n  limitInPlot as commonLimitInPlot,\n  scale,\n  theme as commonTheme,\n  tooltip,\n} from '../../adaptor/common';\nimport { interval } from '../../adaptor/geometries';\nimport { Params } from '../../core/adaptor';\nimport { deepAssign, findGeometry, findViewById, flow, transformLabel } from '../../utils';\nimport { FIRST_AXES_VIEW, SECOND_AXES_VIEW, SERIES_FIELD_KEY } from './constant';\nimport { BidirectionalBarOptions } from './types';\nimport { isHorizontal, transformData } from './utils';\n\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { chart, options } = params;\n  const { data, xField, yField, color, barStyle, widthRatio, legend, layout } = options;\n\n  // 处理数据\n  const groupData: any[] = transformData(xField, yField, SERIES_FIELD_KEY, data, isHorizontal(layout));\n  // 在创建子 view 执行后不行，需要在前面处理 legend\n  if (legend) {\n    chart.legend(SERIES_FIELD_KEY, legend);\n  } else if (legend === false) {\n    chart.legend(false);\n  }\n  // 创建 view\n  let firstView: View;\n  let secondView: View;\n  const [firstViewData, secondViewData] = groupData;\n\n  // 横向\n  if (isHorizontal(layout)) {\n    firstView = chart.createView({\n      region: {\n        start: { x: 0, y: 0 },\n        end: { x: 0.5, y: 1 },\n      },\n      id: FIRST_AXES_VIEW,\n    });\n\n    firstView.coordinate().transpose().reflect('x');\n\n    secondView = chart.createView({\n      region: {\n        start: { x: 0.5, y: 0 },\n        end: { x: 1, y: 1 },\n      },\n      id: SECOND_AXES_VIEW,\n    });\n    secondView.coordinate().transpose();\n\n    // @说明: 测试发现，横向因为轴的反转，需要数据也反转，不然会图形渲染是反的(翻转操作进入到 transform 中处理)\n    firstView.data(firstViewData);\n    secondView.data(secondViewData);\n  } else {\n    // 纵向\n    firstView = chart.createView({\n      region: {\n        start: { x: 0, y: 0 },\n        end: { x: 1, y: 0.5 },\n      },\n      id: FIRST_AXES_VIEW,\n    });\n    secondView = chart.createView({\n      region: {\n        start: { x: 0, y: 0.5 },\n        end: { x: 1, y: 1 },\n      },\n      id: SECOND_AXES_VIEW,\n    });\n    secondView.coordinate().reflect('y');\n\n    firstView.data(firstViewData);\n    secondView.data(secondViewData);\n  }\n  const left = deepAssign({}, params, {\n    chart: firstView,\n    options: {\n      widthRatio,\n      xField,\n      yField: yField[0],\n      seriesField: SERIES_FIELD_KEY,\n      interval: {\n        color,\n        style: barStyle,\n      },\n    },\n  });\n  interval(left);\n\n  const right = deepAssign({}, params, {\n    chart: secondView,\n    options: {\n      xField,\n      yField: yField[1],\n      seriesField: SERIES_FIELD_KEY,\n      widthRatio,\n      interval: {\n        color,\n        style: barStyle,\n      },\n    },\n  });\n\n  interval(right);\n\n  return params;\n}\n\n/**\n * meta 配置\n * - 对称条形图对数据进行了处理，通过 SERIES_FIELD_KEY 来对两条 yField 数据进行分类\n * @param params\n */\nfunction meta(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { options, chart } = params;\n  const { xAxis, yAxis, xField, yField } = options;\n  const firstView = findViewById(chart, FIRST_AXES_VIEW);\n  const secondView = findViewById(chart, SECOND_AXES_VIEW);\n\n  const aliasMap = {};\n  keys(options?.meta || {}).map((metaKey) => {\n    if (get(options?.meta, [metaKey, 'alias'])) {\n      aliasMap[metaKey] = options.meta[metaKey].alias;\n    }\n  });\n\n  chart.scale({\n    [SERIES_FIELD_KEY]: {\n      sync: true,\n      formatter: (v) => {\n        return get(aliasMap, v, v);\n      },\n    },\n  });\n\n  scale({\n    [xField]: xAxis,\n    [yField[0]]: yAxis[yField[0]],\n  })(deepAssign({}, params, { chart: firstView }));\n\n  scale({\n    [xField]: xAxis,\n    [yField[1]]: yAxis[yField[1]],\n  })(deepAssign({}, params, { chart: secondView }));\n\n  return params;\n}\n\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis, xField, yField, layout } = options;\n\n  const firstView = findViewById(chart, FIRST_AXES_VIEW);\n  const secondView = findViewById(chart, SECOND_AXES_VIEW);\n  // 第二个 view axis 始终隐藏; 注意 bottom 的时候，只隐藏 label，其他共用配置\n  // @ts-ignore\n  if (xAxis?.position === 'bottom') {\n    // fixme 直接设置 label: null 会导致 tickLine 无法显示\n    secondView.axis(xField, { ...xAxis, label: { formatter: () => '' } });\n  } else {\n    secondView.axis(xField, false);\n  }\n\n  // 为 false 则是不显示 firstView 轴\n  if (xAxis === false) {\n    firstView.axis(xField, false);\n  } else {\n    firstView.axis(xField, {\n      // 不同布局 firstView 的坐标轴显示位置\n      position: isHorizontal(layout) ? 'top' : 'bottom',\n      ...xAxis,\n    });\n  }\n\n  if (yAxis === false) {\n    firstView.axis(yField[0], false);\n    secondView.axis(yField[1], false);\n  } else {\n    firstView.axis(yField[0], yAxis[yField[0]]);\n    secondView.axis(yField[1], yAxis[yField[1]]);\n  }\n  /**\n   *  这个注入，主要是在syncViewPadding时候拿到相对应的配置：布局和轴的位置\n   *  TODO 之后希望 g2 View 对象可以开放 setter 可以设置一些需要的东西\n   */\n\n  //@ts-ignore\n  chart.__axisPosition = {\n    position: firstView.getOptions().axes[xField].position,\n    layout,\n  };\n  return params;\n}\n\n/**\n * interaction 配置\n * @param params\n */\nexport function interaction(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { chart } = params;\n\n  commonInteraction(deepAssign({}, params, { chart: findViewById(chart, FIRST_AXES_VIEW) }));\n  commonInteraction(deepAssign({}, params, { chart: findViewById(chart, SECOND_AXES_VIEW) }));\n\n  return params;\n}\n\n/**\n * limitInPlot\n * @param params\n */\nexport function limitInPlot(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { chart, options } = params;\n  const { yField, yAxis } = options;\n\n  commonLimitInPlot(\n    deepAssign({}, params, {\n      chart: findViewById(chart, FIRST_AXES_VIEW),\n      options: {\n        yAxis: yAxis[yField[0]],\n      },\n    })\n  );\n\n  commonLimitInPlot(\n    deepAssign({}, params, {\n      chart: findViewById(chart, SECOND_AXES_VIEW),\n      options: {\n        yAxis: yAxis[yField[1]],\n      },\n    })\n  );\n\n  return params;\n}\n\n/**\n * theme\n * @param params\n */\nexport function theme(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { chart } = params;\n\n  commonTheme(deepAssign({}, params, { chart: findViewById(chart, FIRST_AXES_VIEW) }));\n  commonTheme(deepAssign({}, params, { chart: findViewById(chart, SECOND_AXES_VIEW) }));\n  commonTheme(params);\n\n  return params;\n}\n\n/**\n * animation\n * @param params\n */\nexport function animation(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { chart } = params;\n\n  commonAnimation(deepAssign({}, params, { chart: findViewById(chart, FIRST_AXES_VIEW) }));\n  commonAnimation(deepAssign({}, params, { chart: findViewById(chart, SECOND_AXES_VIEW) }));\n\n  return params;\n}\n\n/**\n * label 配置 (1. 设置 offset 偏移量默认值 2. leftView 偏移量需要 *= -1)\n * @param params\n */\nfunction label(params: Params<BidirectionalBarOptions>): Params<BidirectionalBarOptions> {\n  const { chart, options } = params;\n  const { label, yField, layout } = options;\n\n  const firstView = findViewById(chart, FIRST_AXES_VIEW);\n  const secondView = findViewById(chart, SECOND_AXES_VIEW);\n  const leftGeometry = findGeometry(firstView, 'interval');\n  const rightGeometry = findGeometry(secondView, 'interval');\n\n  if (!label) {\n    leftGeometry.label(false);\n    rightGeometry.label(false);\n  } else {\n    const { callback, ...cfg } = label;\n    /** ---- 设置默认配置 ---- */\n    // 默认居中\n    if (!cfg.position) {\n      cfg.position = 'middle';\n    }\n    if (cfg.offset === undefined) {\n      cfg.offset = 2;\n    }\n\n    /** ---- leftView label 设置 ---- */\n    const leftLabelCfg = { ...cfg };\n    if (isHorizontal(layout)) {\n      // 设置 textAlign 默认值\n      const textAlign = leftLabelCfg.style?.textAlign || (cfg.position === 'middle' ? 'center' : 'left');\n      cfg.style = deepAssign({}, cfg.style, { textAlign });\n      const textAlignMap = { left: 'right', right: 'left', center: 'center' };\n      leftLabelCfg.style = deepAssign({}, leftLabelCfg.style, { textAlign: textAlignMap[textAlign] });\n    } else {\n      const positionMap = { top: 'bottom', bottom: 'top', middle: 'middle' };\n      if (typeof cfg.position === 'string') {\n        cfg.position = positionMap[cfg.position];\n      } else if (typeof cfg.position === 'function') {\n        cfg.position = (...args) => positionMap[(cfg.position as Function).apply(this, args)];\n      }\n      // 设置 textBaseline 默认值\n      const textBaseline = leftLabelCfg.style?.textBaseline || 'bottom';\n      leftLabelCfg.style = deepAssign({}, leftLabelCfg.style, { textBaseline });\n      const textBaselineMap = { top: 'bottom', bottom: 'top', middle: 'middle' };\n      cfg.style = deepAssign({}, cfg.style, { textBaseline: textBaselineMap[textBaseline] });\n    }\n\n    leftGeometry.label({\n      fields: [yField[0]],\n      callback,\n      cfg: transformLabel(leftLabelCfg),\n    });\n    rightGeometry.label({\n      fields: [yField[1]],\n      callback,\n      cfg: transformLabel(cfg),\n    });\n  }\n\n  return params;\n}\n\n/**\n * 对称条形图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<BidirectionalBarOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(geometry, meta, axis, limitInPlot, theme, label, tooltip, interaction, animation)(params);\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}