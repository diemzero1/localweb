{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport { Action } from '@antv/g2';\nimport { each, filter, get, map } from '@antv/util';\nimport { conversionTag as basicConversionTag } from '../geometries/basic';\nimport { CONVERSION_TAG_NAME, transformData } from '../geometries/common';\nimport { compareConversionTag } from '../geometries/compare';\n/**\n * Funnel 转化率跟随 legend 变化事件\n */\nvar ConversionTagAction = /** @class */function (_super) {\n  __extends(ConversionTagAction, _super);\n  function ConversionTagAction() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.rendering = false;\n    return _this;\n  }\n  ConversionTagAction.prototype.change = function (options) {\n    var _this = this;\n    // 防止多次重复渲染\n    if (!this.rendering) {\n      var seriesField = options.seriesField,\n        compareField = options.compareField;\n      var conversionTag_1 = compareField ? compareConversionTag : basicConversionTag;\n      var view = this.context.view;\n      // 兼容分面漏斗图\n      var views = seriesField || compareField ? view.views : [view];\n      map(views, function (v, index) {\n        // 防止影响其他 annotations 被去除\n        var annotationController = v.getController('annotation');\n        var annotations = filter(get(annotationController, ['option'], []), function (_a) {\n          var name = _a.name;\n          return name !== CONVERSION_TAG_NAME;\n        });\n        annotationController.clear(true);\n        each(annotations, function (annotation) {\n          if (typeof annotation === 'object') {\n            v.annotation()[annotation.type](annotation);\n          }\n        });\n        var data = get(v, ['filteredData'], v.getOptions().data);\n        conversionTag_1({\n          chart: v,\n          index: index,\n          options: __assign(__assign({}, options), {\n            // @ts-ignore\n            filteredData: transformData(data, data, options)\n          })\n        });\n        v.filterData(data);\n        _this.rendering = true;\n        v.render(true);\n      });\n    }\n    this.rendering = false;\n  };\n  return ConversionTagAction;\n}(Action);\nexport { ConversionTagAction };","map":{"version":3,"mappings":";AAAA,SAASA,MAAM,QAAQ,UAAU;AACjC,SAASC,IAAI,EAAEC,MAAM,EAAEC,GAAG,EAAEC,GAAG,QAAQ,YAAY;AACnD,SAASC,aAAa,IAAIC,kBAAkB,QAAQ,qBAAqB;AACzE,SAASC,mBAAmB,EAAEC,aAAa,QAAQ,sBAAsB;AACzE,SAASC,oBAAoB,QAAQ,uBAAuB;AAG5D;;;AAGA;EAAyCC;EAAzC;IAAA;IACUC,eAAS,GAAG,KAAK;;EA6C3B;EA5CSC,oCAAM,GAAb,UAAcC,OAAsB;IAApC;IACE;IACA,IAAI,CAAC,IAAI,CAACC,SAAS,EAAE;MACX,eAAW,GAAmBD,OAAO,YAA1B;QAAEE,YAAY,GAAKF,OAAO,aAAZ;MACjC,IAAMG,eAAa,GAAGD,YAAY,GAAGN,oBAAoB,GAAGH,kBAAkB;MACtE,QAAI,GAAK,IAAI,CAACW,OAAO,KAAjB;MACZ;MACA,IAAMC,KAAK,GAAGC,WAAW,IAAIJ,YAAY,GAAGK,IAAI,CAACF,KAAK,GAAG,CAACE,IAAI,CAAC;MAC/DhB,GAAG,CAACc,KAAK,EAAE,UAACG,CAAC,EAAEC,KAAK;QAClB;QACA,IAAMC,oBAAoB,GAAGF,CAAC,CAACG,aAAa,CAAC,YAAY,CAAC;QAE1D,IAAMC,WAAW,GAAGvB,MAAM,CACxBC,GAAG,CAACoB,oBAAoB,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC,EACzC,UAACG,EAAQ;cAANC,IAAI;UAAO,WAAI,KAAKpB,mBAAmB;QAA5B,CAA4B,CAC3C;QAEDgB,oBAAoB,CAACK,KAAK,CAAC,IAAI,CAAC;QAEhC3B,IAAI,CAACwB,WAAW,EAAE,UAACI,UAAU;UAC3B,IAAI,OAAOA,UAAU,KAAK,QAAQ,EAAE;YAClCR,CAAC,CAACQ,UAAU,EAAE,CAACA,UAAU,CAACC,IAAI,CAAC,CAACD,UAAU,CAAC;;QAE/C,CAAC,CAAC;QAEF,IAAME,IAAI,GAAG5B,GAAG,CAACkB,CAAC,EAAE,CAAC,cAAc,CAAC,EAAEA,CAAC,CAACW,UAAU,EAAE,CAACD,IAAI,CAAC;QAE1Df,eAAa,CAAC;UACZiB,KAAK,EAAEZ,CAAC;UACRC,KAAK;UACLT,OAAO,wBACFA,OAAO;YACV;YACAqB,YAAY,EAAE1B,aAAa,CAACuB,IAAI,EAAEA,IAAI,EAAElB,OAAO;UAAC;SAEnD,CAAC;QAEFQ,CAAC,CAACc,UAAU,CAACJ,IAAI,CAAC;QAClBpB,KAAI,CAACG,SAAS,GAAG,IAAI;QACrBO,CAAC,CAACe,MAAM,CAAC,IAAI,CAAC;MAChB,CAAC,CAAC;;IAEJ,IAAI,CAACtB,SAAS,GAAG,KAAK;EACxB,CAAC;EACH,0BAAC;AAAD,CAAC,CA9CwCd,MAAM","names":["Action","each","filter","get","map","conversionTag","basicConversionTag","CONVERSION_TAG_NAME","transformData","compareConversionTag","__extends","_this","ConversionTagAction","options","rendering","compareField","conversionTag_1","context","views","seriesField","view","v","index","annotationController","getController","annotations","_a","name","clear","annotation","type","data","getOptions","chart","filteredData","filterData","render"],"sources":["/home/iam/Documents/network/node_modules/@antv/g2plot/src/plots/funnel/interactions/funnel-conversion-tag.ts"],"sourcesContent":["import { Action } from '@antv/g2';\nimport { each, filter, get, map } from '@antv/util';\nimport { conversionTag as basicConversionTag } from '../geometries/basic';\nimport { CONVERSION_TAG_NAME, transformData } from '../geometries/common';\nimport { compareConversionTag } from '../geometries/compare';\nimport { FunnelOptions } from '../types';\n\n/**\n * Funnel 转化率跟随 legend 变化事件\n */\nexport class ConversionTagAction extends Action {\n  private rendering = false;\n  public change(options: FunnelOptions) {\n    // 防止多次重复渲染\n    if (!this.rendering) {\n      const { seriesField, compareField } = options;\n      const conversionTag = compareField ? compareConversionTag : basicConversionTag;\n      const { view } = this.context;\n      // 兼容分面漏斗图\n      const views = seriesField || compareField ? view.views : [view];\n      map(views, (v, index) => {\n        // 防止影响其他 annotations 被去除\n        const annotationController = v.getController('annotation');\n\n        const annotations = filter(\n          get(annotationController, ['option'], []),\n          ({ name }) => name !== CONVERSION_TAG_NAME\n        );\n\n        annotationController.clear(true);\n\n        each(annotations, (annotation) => {\n          if (typeof annotation === 'object') {\n            v.annotation()[annotation.type](annotation);\n          }\n        });\n\n        const data = get(v, ['filteredData'], v.getOptions().data);\n\n        conversionTag({\n          chart: v,\n          index,\n          options: {\n            ...options,\n            // @ts-ignore\n            filteredData: transformData(data, data, options),\n          },\n        });\n\n        v.filterData(data);\n        this.rendering = true;\n        v.render(true);\n      });\n    }\n    this.rendering = false;\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}