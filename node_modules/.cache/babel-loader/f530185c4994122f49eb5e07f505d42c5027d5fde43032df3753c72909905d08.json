{"ast":null,"code":"import { __assign } from \"tslib\";\n/*\n * @Author: moyee\n * @LastEditors: moyee\n * @Description: 拖动 Combo\n */\nimport { each } from '@antv/util';\nimport Util from '../util';\nimport Global from '../global';\nvar calculationItemsBBox = Util.calculationItemsBBox;\n/**\n * 遍历拖动的 Combo 下的所有 Combo\n * @param data 拖动的 Combo\n * @param fn\n */\nvar traverseCombo = function traverseCombo(data, fn) {\n  if (fn(data) === false) {\n    return;\n  }\n  if (data) {\n    var combos = data.get('combos');\n    if (combos.length === 0) {\n      return false;\n    }\n    each(combos, function (child) {\n      traverseCombo(child, fn);\n    });\n  }\n};\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      enableDelegate: false,\n      delegateStyle: {},\n      // 拖动节点过程中是否只改变 Combo 的大小，而不改变其结构\n      onlyChangeComboSize: false,\n      // 拖动过程中目标 combo 状态样式\n      activeState: '',\n      selectedState: 'selected',\n      enableStack: true\n    };\n  },\n  getEvents: function getEvents() {\n    return {\n      'combo:dragstart': 'onDragStart',\n      'combo:drag': 'onDrag',\n      'combo:dragend': 'onDragEnd',\n      'combo:drop': 'onDrop',\n      'node:drop': 'onNodeDrop',\n      'combo:dragenter': 'onDragEnter',\n      'combo:dragleave': 'onDragLeave'\n    };\n  },\n  validationCombo: function validationCombo(evt) {\n    var item = evt.item;\n    if (!item || item.destroyed) {\n      return false;\n    }\n    if (!this.shouldUpdate(evt, this)) {\n      return false;\n    }\n    var type = item.getType();\n    if (type !== 'combo') {\n      return false;\n    }\n    return true;\n  },\n  onDragStart: function onDragStart(evt) {\n    var _this = this;\n    var graph = this.graph;\n    var item = evt.item;\n    this.currentShouldEnd = true;\n    if (!this.validationCombo(evt)) return;\n    this.targets = [];\n    // 获取所有选中的 Combo\n    var combos = graph.findAllByState('combo', this.selectedState);\n    var currentCombo = item.get('id');\n    var dragCombos = combos.filter(function (combo) {\n      var comboId = combo.get('id');\n      return currentCombo === comboId;\n    });\n    if (dragCombos.length === 0) {\n      this.targets.push(item);\n    } else {\n      this.targets = combos;\n    }\n    var beforeDragItems = [];\n    this.targets.forEach(function (t) {\n      var _a = t.getModel(),\n        x = _a.x,\n        y = _a.y,\n        id = _a.id;\n      beforeDragItems.push({\n        x: x,\n        y: y,\n        id: id\n      });\n    });\n    this.set('beforeDragItems', beforeDragItems);\n    if (this.activeState) {\n      this.targets.map(function (combo) {\n        var model = combo.getModel();\n        if (model.parentId) {\n          var parentCombo = graph.findById(model.parentId);\n          if (parentCombo) {\n            graph.setItemState(parentCombo, _this.activeState, true);\n          }\n        }\n      });\n    }\n    this.point = {};\n    this.originPoint = {};\n    this.origin = {\n      x: evt.x,\n      y: evt.y\n    };\n    this.currentItemChildCombos = [];\n    traverseCombo(item, function (param) {\n      if (param.destroyed) {\n        return false;\n      }\n      var model = param.getModel();\n      _this.currentItemChildCombos.push(model.id);\n      return true;\n    });\n  },\n  onDrag: function onDrag(evt) {\n    var _this = this;\n    if (!this.origin) {\n      return;\n    }\n    if (!this.validationCombo(evt)) return;\n    if (this.enableDelegate) {\n      this.updateDelegate(evt);\n    } else {\n      if (this.activeState) {\n        var graph_1 = this.graph;\n        var item = evt.item;\n        var model_1 = item.getModel();\n        // 拖动过程中实时计算距离\n        var combos = graph_1.getCombos();\n        var sourceBBox = item.getBBox();\n        var centerX_1 = sourceBBox.centerX,\n          centerY_1 = sourceBBox.centerY,\n          width_1 = sourceBBox.width;\n        // 参与计算的 Combo，需要排除掉：\n        // 1、拖动 combo 自己\n        // 2、拖动 combo 的 parent\n        // 3、拖动 Combo 的 children\n        var calcCombos = combos.filter(function (combo) {\n          var cmodel = combo.getModel();\n          // 被拖动的是最外层的 Combo，无 parent，排除自身和子元素\n          if (!model_1.parentId) {\n            return cmodel.id !== model_1.id && !_this.currentItemChildCombos.includes(cmodel.id);\n          }\n          return cmodel.id !== model_1.id && !_this.currentItemChildCombos.includes(cmodel.id);\n        });\n        calcCombos.map(function (combo) {\n          var _a = combo.getBBox(),\n            cx = _a.centerX,\n            cy = _a.centerY,\n            w = _a.width;\n          // 拖动的 combo 和要进入的 combo 之间的距离\n          var disX = centerX_1 - cx;\n          var disY = centerY_1 - cy;\n          // 圆心距离\n          var distance = 2 * Math.sqrt(disX * disX + disY * disY);\n          if (width_1 + w - distance > 0.8 * width_1) {\n            graph_1.setItemState(combo, _this.activeState, true);\n          } else {\n            graph_1.setItemState(combo, _this.activeState, false);\n          }\n        });\n      }\n      each(this.targets, function (item) {\n        _this.updateCombo(item, evt);\n      });\n    }\n  },\n  updatePositions: function updatePositions(evt, restore) {\n    var _this = this;\n    // 当启用 delegate 时，拖动结束时需要更新 combo\n    if (this.enableDelegate || restore) {\n      each(this.targets, function (item) {\n        _this.updateCombo(item, evt, restore);\n      });\n    }\n  },\n  onDrop: function onDrop(evt) {\n    var _this = this;\n    // 被放下的目标 combo\n    var item = evt.item;\n    this.currentShouldEnd = this.shouldEnd(evt, item, this);\n    this.updatePositions(evt, !this.currentShouldEnd);\n    if (!this.currentShouldEnd || !item || !this.targets || item.destroyed) return;\n    var graph = this.graph;\n    var targetModel = item.getModel();\n    this.targets.map(function (combo) {\n      var model = combo.getModel();\n      if (model.parentId !== targetModel.id) {\n        if (_this.activeState) {\n          graph.setItemState(item, _this.activeState, false);\n        }\n        // 将 Combo 放置到某个 Combo 上面时，只有当 onlyChangeComboSize 为 false 时候才更新 Combo 结构\n        if (!_this.onlyChangeComboSize) {\n          graph.updateComboTree(combo, targetModel.id, false);\n        } else {\n          graph.updateCombo(combo);\n        }\n      } else {\n        graph.updateCombo(item);\n      }\n    });\n    this.end(item, evt);\n    // 如果已经拖放下了，则不需要再通过距离判断了\n    this.endComparison = true;\n  },\n  onNodeDrop: function onNodeDrop(evt) {\n    var _this = this;\n    if (!this.targets || this.targets.length === 0) return;\n    var graph = this.graph;\n    var item = evt.item;\n    var comboId = item.getModel().comboId;\n    var newParentCombo = comboId ? graph.findById(comboId) : undefined;\n    this.currentShouldEnd = this.shouldEnd(evt, newParentCombo, this);\n    this.updatePositions(evt, !this.currentShouldEnd);\n    if (!this.currentShouldEnd) return;\n    var droppedCombo;\n    // 如果被放置的的节点有 comboId，且这个 comboId 与正在被拖拽的 combo 的父 id 不相同，则更新父亲为 comboId\n    if (comboId) {\n      if (this.activeState) {\n        var combo = graph.findById(comboId);\n        graph.setItemState(combo, this.activeState, false);\n      }\n      this.targets.map(function (combo) {\n        if (!_this.onlyChangeComboSize) {\n          if (comboId !== combo.getID()) {\n            droppedCombo = graph.findById(comboId);\n            if (comboId !== combo.getModel().parentId) graph.updateComboTree(combo, comboId, false);\n          }\n        } else {\n          graph.updateCombo(combo);\n        }\n      });\n    } else {\n      // 如果被放置的节点没有 comboId，且正在被拖拽的 combo 有父 id，则更新父亲为 undefined\n      this.targets.map(function (combo) {\n        if (!_this.onlyChangeComboSize) {\n          var model = combo.getModel();\n          if (model.comboId) {\n            graph.updateComboTree(combo, undefined, false);\n          }\n        } else {\n          graph.updateCombo(combo);\n        }\n      });\n    }\n    // 如果已经拖放下了，则不需要再通过距离判断了\n    this.endComparison = true;\n    this.end(droppedCombo, evt);\n  },\n  onDragEnter: function onDragEnter(evt) {\n    if (!this.origin) {\n      return;\n    }\n    if (!this.validationCombo(evt)) return;\n    var item = evt.item;\n    var graph = this.graph;\n    if (this.activeState) {\n      graph.setItemState(item, this.activeState, true);\n    }\n  },\n  onDragLeave: function onDragLeave(evt) {\n    if (!this.origin) {\n      return;\n    }\n    if (!this.validationCombo(evt)) return;\n    var item = evt.item;\n    var graph = this.graph;\n    if (this.activeState) {\n      graph.setItemState(item, this.activeState, false);\n    }\n  },\n  onDragEnd: function onDragEnd(evt) {\n    if (!this.targets || this.targets.length === 0) return;\n    var item = evt.item;\n    if (this.currentShouldEnd) {\n      this.updatePositions(evt);\n    }\n    var parentCombo = this.getParentCombo(item.getModel().parentId);\n    var graph = this.graph;\n    if (parentCombo && this.activeState) {\n      graph.setItemState(parentCombo, this.activeState, false);\n    }\n    this.end(undefined, evt);\n  },\n  end: function end(comboDropedOn, evt) {\n    var _this = this;\n    if (!this.origin) return;\n    var graph = this.graph;\n    // 删除delegate shape\n    if (this.delegateShape) {\n      var delegateGroup = graph.get('delegateGroup');\n      delegateGroup.clear();\n      this.delegateShape = null;\n    }\n    if (comboDropedOn && this.activeState) {\n      graph.setItemState(comboDropedOn, this.activeState, false);\n    }\n    // 若没有被放置的 combo，则是被放置在画布上\n    if (!comboDropedOn) {\n      var stack_1 = graph.get('enabledStack') && this.enableStack;\n      var stackData_1 = {\n        before: {\n          nodes: [],\n          edges: [],\n          combos: [].concat(this.get('beforeDragItems'))\n        },\n        after: {\n          nodes: [],\n          edges: [],\n          combos: []\n        }\n      };\n      this.targets.map(function (combo) {\n        // 将 Combo 放置到某个 Combo 上面时，只有当 onlyChangeComboSize 为 false 时候才更新 Combo 结构\n        if (!_this.onlyChangeComboSize) {\n          graph.updateComboTree(combo, undefined, stack_1);\n        } else {\n          graph.updateCombo(combo);\n          var _a = combo.getModel(),\n            x = _a.x,\n            y = _a.y,\n            id = _a.id;\n          stackData_1.after.combos.push({\n            x: x,\n            y: y,\n            id: id\n          });\n          graph.pushStack('update', stackData_1);\n        }\n      });\n    }\n    this.point = [];\n    this.origin = null;\n    this.originPoint = null;\n    this.targets.length = 0;\n  },\n  /**\n   * 遍历 comboTree，分别更新 node 和 combo\n   * @param data\n   * @param fn\n   */\n  traverse: function traverse(data, fn, edgesToBeUpdate) {\n    var _this = this;\n    if (edgesToBeUpdate === void 0) {\n      edgesToBeUpdate = {};\n    }\n    if (fn(data, edgesToBeUpdate) === false) {\n      return;\n    }\n    if (data) {\n      var combos = data.get('combos');\n      each(combos, function (child) {\n        _this.traverse(child, fn, edgesToBeUpdate);\n      });\n      var nodes = data.get('nodes');\n      each(nodes, function (child) {\n        _this.traverse(child, fn, edgesToBeUpdate);\n      });\n    }\n  },\n  updateCombo: function updateCombo(item, evt, restore) {\n    this.updateSingleItem(item, evt, restore);\n    var edgesToBeUpdate = {};\n    this.traverse(item, function (paramItem, paramEdgesMap) {\n      if (paramItem.destroyed) {\n        return false;\n      }\n      paramItem.getEdges().forEach(function (edge) {\n        return paramEdgesMap[edge.getID()] = edge;\n      });\n      return true;\n    }, edgesToBeUpdate);\n    Object.values(edgesToBeUpdate).forEach(function (edge) {\n      return edge.refresh();\n    });\n  },\n  /**\n   *\n   * @param item 当前正在拖动的元素\n   * @param evt\n   */\n  updateSingleItem: function updateSingleItem(item, evt, restore) {\n    var origin = this.origin;\n    var graph = this.graph;\n    var model = item.getModel();\n    var itemId = item.get('id');\n    if (!this.point[itemId]) {\n      this.point[itemId] = {\n        x: model.x,\n        y: model.y\n      };\n    }\n    var x = evt.x - origin.x + this.point[itemId].x;\n    var y = evt.y - origin.y + this.point[itemId].y;\n    if (restore) {\n      x += origin.x - evt.x;\n      y += origin.y - evt.y;\n    }\n    graph.updateItem(item, {\n      x: x,\n      y: y\n    }, false);\n    // item.getEdges()?.forEach(edge => edge.refresh());\n  },\n\n  /**\n   * 根据 ID 获取父 Combo\n   * @param parentId 父 Combo ID\n   */\n  getParentCombo: function getParentCombo(parentId) {\n    var graph = this.graph;\n    if (!parentId) {\n      return undefined;\n    }\n    var parentCombo = graph.findById(parentId);\n    if (!parentCombo) {\n      return undefined;\n    }\n    return parentCombo;\n  },\n  updateDelegate: function updateDelegate(evt) {\n    var graph = this.graph;\n    // 当没有 delegate shape 时创建\n    if (!this.delegateShape) {\n      var delegateGroup = graph.get('delegateGroup');\n      var bbox = null;\n      if (this.targets.length > 1) {\n        bbox = calculationItemsBBox(this.targets);\n      } else {\n        bbox = this.targets[0].getBBox();\n      }\n      var x = bbox.x,\n        y = bbox.y,\n        width = bbox.width,\n        height = bbox.height,\n        minX = bbox.minX,\n        minY = bbox.minY;\n      this.originPoint = {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        minX: minX,\n        minY: minY\n      };\n      var attrs = __assign(__assign({}, Global.delegateStyle), this.delegateStyle);\n      this.delegateShape = delegateGroup.addShape('rect', {\n        attrs: __assign({\n          width: bbox.width,\n          height: bbox.height,\n          x: bbox.x,\n          y: bbox.y\n        }, attrs),\n        name: 'combo-delegate-shape'\n      });\n      this.delegateShape.set('capture', false);\n      this.delegate = this.delegateShape;\n    } else {\n      var clientX = evt.x - this.origin.x + this.originPoint.minX;\n      var clientY = evt.y - this.origin.y + this.originPoint.minY;\n      this.delegateShape.attr({\n        x: clientX,\n        y: clientY\n      });\n    }\n  }\n};","map":{"version":3,"names":["__assign","each","Util","Global","calculationItemsBBox","traverseCombo","data","fn","combos","get","length","child","getDefaultCfg","enableDelegate","delegateStyle","onlyChangeComboSize","activeState","selectedState","enableStack","getEvents","validationCombo","evt","item","destroyed","shouldUpdate","type","getType","onDragStart","_this","graph","currentShouldEnd","targets","findAllByState","currentCombo","dragCombos","filter","combo","comboId","push","beforeDragItems","forEach","t","_a","getModel","x","y","id","set","map","model","parentId","parentCombo","findById","setItemState","point","originPoint","origin","currentItemChildCombos","param","onDrag","updateDelegate","graph_1","model_1","getCombos","sourceBBox","getBBox","centerX_1","centerX","centerY_1","centerY","width_1","width","calcCombos","cmodel","includes","cx","cy","w","disX","disY","distance","Math","sqrt","updateCombo","updatePositions","restore","onDrop","shouldEnd","targetModel","updateComboTree","end","endComparison","onNodeDrop","newParentCombo","undefined","droppedCombo","getID","onDragEnter","onDragLeave","onDragEnd","getParentCombo","comboDropedOn","delegateShape","delegateGroup","clear","stack_1","stackData_1","before","nodes","edges","concat","after","pushStack","traverse","edgesToBeUpdate","updateSingleItem","paramItem","paramEdgesMap","getEdges","edge","Object","values","refresh","itemId","updateItem","bbox","height","minX","minY","attrs","addShape","name","delegate","clientX","clientY","attr"],"sources":["/home/iam/Documents/LocalWeb-master/node_modules/@antv/g6-pc/es/behavior/drag-combo.js"],"sourcesContent":["import { __assign } from \"tslib\";\n/*\n * @Author: moyee\n * @LastEditors: moyee\n * @Description: 拖动 Combo\n */\nimport { each } from '@antv/util';\nimport Util from '../util';\nimport Global from '../global';\nvar calculationItemsBBox = Util.calculationItemsBBox;\n/**\n * 遍历拖动的 Combo 下的所有 Combo\n * @param data 拖动的 Combo\n * @param fn\n */\nvar traverseCombo = function traverseCombo(data, fn) {\n  if (fn(data) === false) {\n    return;\n  }\n  if (data) {\n    var combos = data.get('combos');\n    if (combos.length === 0) {\n      return false;\n    }\n    each(combos, function (child) {\n      traverseCombo(child, fn);\n    });\n  }\n};\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      enableDelegate: false,\n      delegateStyle: {},\n      // 拖动节点过程中是否只改变 Combo 的大小，而不改变其结构\n      onlyChangeComboSize: false,\n      // 拖动过程中目标 combo 状态样式\n      activeState: '',\n      selectedState: 'selected',\n      enableStack: true\n    };\n  },\n  getEvents: function getEvents() {\n    return {\n      'combo:dragstart': 'onDragStart',\n      'combo:drag': 'onDrag',\n      'combo:dragend': 'onDragEnd',\n      'combo:drop': 'onDrop',\n      'node:drop': 'onNodeDrop',\n      'combo:dragenter': 'onDragEnter',\n      'combo:dragleave': 'onDragLeave'\n    };\n  },\n  validationCombo: function validationCombo(evt) {\n    var item = evt.item;\n    if (!item || item.destroyed) {\n      return false;\n    }\n    if (!this.shouldUpdate(evt, this)) {\n      return false;\n    }\n    var type = item.getType();\n    if (type !== 'combo') {\n      return false;\n    }\n    return true;\n  },\n  onDragStart: function onDragStart(evt) {\n    var _this = this;\n    var graph = this.graph;\n    var item = evt.item;\n    this.currentShouldEnd = true;\n    if (!this.validationCombo(evt)) return;\n    this.targets = [];\n    // 获取所有选中的 Combo\n    var combos = graph.findAllByState('combo', this.selectedState);\n    var currentCombo = item.get('id');\n    var dragCombos = combos.filter(function (combo) {\n      var comboId = combo.get('id');\n      return currentCombo === comboId;\n    });\n    if (dragCombos.length === 0) {\n      this.targets.push(item);\n    } else {\n      this.targets = combos;\n    }\n    var beforeDragItems = [];\n    this.targets.forEach(function (t) {\n      var _a = t.getModel(),\n        x = _a.x,\n        y = _a.y,\n        id = _a.id;\n      beforeDragItems.push({\n        x: x,\n        y: y,\n        id: id\n      });\n    });\n    this.set('beforeDragItems', beforeDragItems);\n    if (this.activeState) {\n      this.targets.map(function (combo) {\n        var model = combo.getModel();\n        if (model.parentId) {\n          var parentCombo = graph.findById(model.parentId);\n          if (parentCombo) {\n            graph.setItemState(parentCombo, _this.activeState, true);\n          }\n        }\n      });\n    }\n    this.point = {};\n    this.originPoint = {};\n    this.origin = {\n      x: evt.x,\n      y: evt.y\n    };\n    this.currentItemChildCombos = [];\n    traverseCombo(item, function (param) {\n      if (param.destroyed) {\n        return false;\n      }\n      var model = param.getModel();\n      _this.currentItemChildCombos.push(model.id);\n      return true;\n    });\n  },\n  onDrag: function onDrag(evt) {\n    var _this = this;\n    if (!this.origin) {\n      return;\n    }\n    if (!this.validationCombo(evt)) return;\n    if (this.enableDelegate) {\n      this.updateDelegate(evt);\n    } else {\n      if (this.activeState) {\n        var graph_1 = this.graph;\n        var item = evt.item;\n        var model_1 = item.getModel();\n        // 拖动过程中实时计算距离\n        var combos = graph_1.getCombos();\n        var sourceBBox = item.getBBox();\n        var centerX_1 = sourceBBox.centerX,\n          centerY_1 = sourceBBox.centerY,\n          width_1 = sourceBBox.width;\n        // 参与计算的 Combo，需要排除掉：\n        // 1、拖动 combo 自己\n        // 2、拖动 combo 的 parent\n        // 3、拖动 Combo 的 children\n        var calcCombos = combos.filter(function (combo) {\n          var cmodel = combo.getModel();\n          // 被拖动的是最外层的 Combo，无 parent，排除自身和子元素\n          if (!model_1.parentId) {\n            return cmodel.id !== model_1.id && !_this.currentItemChildCombos.includes(cmodel.id);\n          }\n          return cmodel.id !== model_1.id && !_this.currentItemChildCombos.includes(cmodel.id);\n        });\n        calcCombos.map(function (combo) {\n          var _a = combo.getBBox(),\n            cx = _a.centerX,\n            cy = _a.centerY,\n            w = _a.width;\n          // 拖动的 combo 和要进入的 combo 之间的距离\n          var disX = centerX_1 - cx;\n          var disY = centerY_1 - cy;\n          // 圆心距离\n          var distance = 2 * Math.sqrt(disX * disX + disY * disY);\n          if (width_1 + w - distance > 0.8 * width_1) {\n            graph_1.setItemState(combo, _this.activeState, true);\n          } else {\n            graph_1.setItemState(combo, _this.activeState, false);\n          }\n        });\n      }\n      each(this.targets, function (item) {\n        _this.updateCombo(item, evt);\n      });\n    }\n  },\n  updatePositions: function updatePositions(evt, restore) {\n    var _this = this;\n    // 当启用 delegate 时，拖动结束时需要更新 combo\n    if (this.enableDelegate || restore) {\n      each(this.targets, function (item) {\n        _this.updateCombo(item, evt, restore);\n      });\n    }\n  },\n  onDrop: function onDrop(evt) {\n    var _this = this;\n    // 被放下的目标 combo\n    var item = evt.item;\n    this.currentShouldEnd = this.shouldEnd(evt, item, this);\n    this.updatePositions(evt, !this.currentShouldEnd);\n    if (!this.currentShouldEnd || !item || !this.targets || item.destroyed) return;\n    var graph = this.graph;\n    var targetModel = item.getModel();\n    this.targets.map(function (combo) {\n      var model = combo.getModel();\n      if (model.parentId !== targetModel.id) {\n        if (_this.activeState) {\n          graph.setItemState(item, _this.activeState, false);\n        }\n        // 将 Combo 放置到某个 Combo 上面时，只有当 onlyChangeComboSize 为 false 时候才更新 Combo 结构\n        if (!_this.onlyChangeComboSize) {\n          graph.updateComboTree(combo, targetModel.id, false);\n        } else {\n          graph.updateCombo(combo);\n        }\n      } else {\n        graph.updateCombo(item);\n      }\n    });\n    this.end(item, evt);\n    // 如果已经拖放下了，则不需要再通过距离判断了\n    this.endComparison = true;\n  },\n  onNodeDrop: function onNodeDrop(evt) {\n    var _this = this;\n    if (!this.targets || this.targets.length === 0) return;\n    var graph = this.graph;\n    var item = evt.item;\n    var comboId = item.getModel().comboId;\n    var newParentCombo = comboId ? graph.findById(comboId) : undefined;\n    this.currentShouldEnd = this.shouldEnd(evt, newParentCombo, this);\n    this.updatePositions(evt, !this.currentShouldEnd);\n    if (!this.currentShouldEnd) return;\n    var droppedCombo;\n    // 如果被放置的的节点有 comboId，且这个 comboId 与正在被拖拽的 combo 的父 id 不相同，则更新父亲为 comboId\n    if (comboId) {\n      if (this.activeState) {\n        var combo = graph.findById(comboId);\n        graph.setItemState(combo, this.activeState, false);\n      }\n      this.targets.map(function (combo) {\n        if (!_this.onlyChangeComboSize) {\n          if (comboId !== combo.getID()) {\n            droppedCombo = graph.findById(comboId);\n            if (comboId !== combo.getModel().parentId) graph.updateComboTree(combo, comboId, false);\n          }\n        } else {\n          graph.updateCombo(combo);\n        }\n      });\n    } else {\n      // 如果被放置的节点没有 comboId，且正在被拖拽的 combo 有父 id，则更新父亲为 undefined\n      this.targets.map(function (combo) {\n        if (!_this.onlyChangeComboSize) {\n          var model = combo.getModel();\n          if (model.comboId) {\n            graph.updateComboTree(combo, undefined, false);\n          }\n        } else {\n          graph.updateCombo(combo);\n        }\n      });\n    }\n    // 如果已经拖放下了，则不需要再通过距离判断了\n    this.endComparison = true;\n    this.end(droppedCombo, evt);\n  },\n  onDragEnter: function onDragEnter(evt) {\n    if (!this.origin) {\n      return;\n    }\n    if (!this.validationCombo(evt)) return;\n    var item = evt.item;\n    var graph = this.graph;\n    if (this.activeState) {\n      graph.setItemState(item, this.activeState, true);\n    }\n  },\n  onDragLeave: function onDragLeave(evt) {\n    if (!this.origin) {\n      return;\n    }\n    if (!this.validationCombo(evt)) return;\n    var item = evt.item;\n    var graph = this.graph;\n    if (this.activeState) {\n      graph.setItemState(item, this.activeState, false);\n    }\n  },\n  onDragEnd: function onDragEnd(evt) {\n    if (!this.targets || this.targets.length === 0) return;\n    var item = evt.item;\n    if (this.currentShouldEnd) {\n      this.updatePositions(evt);\n    }\n    var parentCombo = this.getParentCombo(item.getModel().parentId);\n    var graph = this.graph;\n    if (parentCombo && this.activeState) {\n      graph.setItemState(parentCombo, this.activeState, false);\n    }\n    this.end(undefined, evt);\n  },\n  end: function end(comboDropedOn, evt) {\n    var _this = this;\n    if (!this.origin) return;\n    var graph = this.graph;\n    // 删除delegate shape\n    if (this.delegateShape) {\n      var delegateGroup = graph.get('delegateGroup');\n      delegateGroup.clear();\n      this.delegateShape = null;\n    }\n    if (comboDropedOn && this.activeState) {\n      graph.setItemState(comboDropedOn, this.activeState, false);\n    }\n    // 若没有被放置的 combo，则是被放置在画布上\n    if (!comboDropedOn) {\n      var stack_1 = graph.get('enabledStack') && this.enableStack;\n      var stackData_1 = {\n        before: {\n          nodes: [],\n          edges: [],\n          combos: [].concat(this.get('beforeDragItems'))\n        },\n        after: {\n          nodes: [],\n          edges: [],\n          combos: []\n        }\n      };\n      this.targets.map(function (combo) {\n        // 将 Combo 放置到某个 Combo 上面时，只有当 onlyChangeComboSize 为 false 时候才更新 Combo 结构\n        if (!_this.onlyChangeComboSize) {\n          graph.updateComboTree(combo, undefined, stack_1);\n        } else {\n          graph.updateCombo(combo);\n          var _a = combo.getModel(),\n            x = _a.x,\n            y = _a.y,\n            id = _a.id;\n          stackData_1.after.combos.push({\n            x: x,\n            y: y,\n            id: id\n          });\n          graph.pushStack('update', stackData_1);\n        }\n      });\n    }\n    this.point = [];\n    this.origin = null;\n    this.originPoint = null;\n    this.targets.length = 0;\n  },\n  /**\n   * 遍历 comboTree，分别更新 node 和 combo\n   * @param data\n   * @param fn\n   */\n  traverse: function traverse(data, fn, edgesToBeUpdate) {\n    var _this = this;\n    if (edgesToBeUpdate === void 0) {\n      edgesToBeUpdate = {};\n    }\n    if (fn(data, edgesToBeUpdate) === false) {\n      return;\n    }\n    if (data) {\n      var combos = data.get('combos');\n      each(combos, function (child) {\n        _this.traverse(child, fn, edgesToBeUpdate);\n      });\n      var nodes = data.get('nodes');\n      each(nodes, function (child) {\n        _this.traverse(child, fn, edgesToBeUpdate);\n      });\n    }\n  },\n  updateCombo: function updateCombo(item, evt, restore) {\n    this.updateSingleItem(item, evt, restore);\n    var edgesToBeUpdate = {};\n    this.traverse(item, function (paramItem, paramEdgesMap) {\n      if (paramItem.destroyed) {\n        return false;\n      }\n      paramItem.getEdges().forEach(function (edge) {\n        return paramEdgesMap[edge.getID()] = edge;\n      });\n      return true;\n    }, edgesToBeUpdate);\n    Object.values(edgesToBeUpdate).forEach(function (edge) {\n      return edge.refresh();\n    });\n  },\n  /**\n   *\n   * @param item 当前正在拖动的元素\n   * @param evt\n   */\n  updateSingleItem: function updateSingleItem(item, evt, restore) {\n    var origin = this.origin;\n    var graph = this.graph;\n    var model = item.getModel();\n    var itemId = item.get('id');\n    if (!this.point[itemId]) {\n      this.point[itemId] = {\n        x: model.x,\n        y: model.y\n      };\n    }\n    var x = evt.x - origin.x + this.point[itemId].x;\n    var y = evt.y - origin.y + this.point[itemId].y;\n    if (restore) {\n      x += origin.x - evt.x;\n      y += origin.y - evt.y;\n    }\n    graph.updateItem(item, {\n      x: x,\n      y: y\n    }, false);\n    // item.getEdges()?.forEach(edge => edge.refresh());\n  },\n\n  /**\n   * 根据 ID 获取父 Combo\n   * @param parentId 父 Combo ID\n   */\n  getParentCombo: function getParentCombo(parentId) {\n    var graph = this.graph;\n    if (!parentId) {\n      return undefined;\n    }\n    var parentCombo = graph.findById(parentId);\n    if (!parentCombo) {\n      return undefined;\n    }\n    return parentCombo;\n  },\n  updateDelegate: function updateDelegate(evt) {\n    var graph = this.graph;\n    // 当没有 delegate shape 时创建\n    if (!this.delegateShape) {\n      var delegateGroup = graph.get('delegateGroup');\n      var bbox = null;\n      if (this.targets.length > 1) {\n        bbox = calculationItemsBBox(this.targets);\n      } else {\n        bbox = this.targets[0].getBBox();\n      }\n      var x = bbox.x,\n        y = bbox.y,\n        width = bbox.width,\n        height = bbox.height,\n        minX = bbox.minX,\n        minY = bbox.minY;\n      this.originPoint = {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        minX: minX,\n        minY: minY\n      };\n      var attrs = __assign(__assign({}, Global.delegateStyle), this.delegateStyle);\n      this.delegateShape = delegateGroup.addShape('rect', {\n        attrs: __assign({\n          width: bbox.width,\n          height: bbox.height,\n          x: bbox.x,\n          y: bbox.y\n        }, attrs),\n        name: 'combo-delegate-shape'\n      });\n      this.delegateShape.set('capture', false);\n      this.delegate = this.delegateShape;\n    } else {\n      var clientX = evt.x - this.origin.x + this.originPoint.minX;\n      var clientY = evt.y - this.origin.y + this.originPoint.minY;\n      this.delegateShape.attr({\n        x: clientX,\n        y: clientY\n      });\n    }\n  }\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}