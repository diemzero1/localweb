{"ast":null,"code":"import _objectSpread from\"/home/iam/Documents/network/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/home/iam/Documents/network/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/iam/Documents/network/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/iam/Documents/network/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{message as antdMessage,Form,Button,message,Upload,Card}from'antd';import axios from\"axios\";import ubusApi from'service/api/ubus-api';import{UploadOutlined}from'@ant-design/icons';import React from'react';import{useTranslation}from\"react-i18next\";import\"../../../../translations/i18n\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var UploadFirmware=function UploadFirmware(props){var _useTranslation=useTranslation(),t=_useTranslation.t;var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),do_upgrade=_React$useState2[0],setDoUpgrade=_React$useState2[1];var tokenString=sessionStorage.getItem('token');var URL=\"/cgi-bin/luci-upload\";var uploadFile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(values){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:data=new FormData();values.token=tokenString;data.append(\"sessionid\",values.token);data.append(\"filename\",\"/tmp/firmware.bin\");data.append(\"filedata\",values.imageFile.file.originFileObj);axios.post(URL,data,{headers:{\"Content-Type\":\"multipart/form-data\"}}).then(function(response){message.success(t(\"upload_success\"));doUpgrade();}).catch(function(error){message.error(t(\"fail\"));});case 6:case\"end\":return _context.stop();}}},_callee);}));return function uploadFile(_x){return _ref.apply(this,arguments);};}();var doUpgrade=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var result,code,key;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return ubusApi.config_system_update();case 2:result=_context2.sent;code=result.code;console.log('upgrade',code);key='updatable';antdMessage.loading({content:t(\"loading\"),key:key});setTimeout(function(){if(code==1||code==2)antdMessage.error({content:t(\"invalid_firmware\"),key:key,duration:2});else antdMessage.success({content:t(\"upgrade_success\"),key:key,duration:2});},5000);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function doUpgrade(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Card,{title:t(\"update_firmware\"),type:\"inner\",headStyle:{background:\"linear-gradient(109.6deg, rgb(44, 83, 131), rgb(44, 83, 131) 18.9%, rgb(68, 124, 143), rgb(44, 83, 131) 91.1%, rgb(44, 83, 131))\",color:'white'},children:/*#__PURE__*/_jsxs(Form,{form:form,labelCol:{span:10},wrapperCol:{span:24},onFinish:uploadFile,children:[/*#__PURE__*/_jsx(Form.Item,{label:t(\"choose_firmware\"),name:\"imageFile\",children:/*#__PURE__*/_jsx(Upload,_objectSpread(_objectSpread({maxCount:1},props),{},{children:/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(UploadOutlined,{}),onClick:uploadFile,children:t(\"upload\")})}))}),/*#__PURE__*/_jsx(Form.Item,{wrapperCol:{offset:10,span:24},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",children:t(\"update\")})})]})});};","map":{"version":3,"names":["message","antdMessage","Form","Button","Upload","Card","axios","ubusApi","UploadOutlined","React","useTranslation","UploadFirmware","props","t","useForm","form","useState","do_upgrade","setDoUpgrade","tokenString","sessionStorage","getItem","URL","uploadFile","values","data","FormData","token","append","imageFile","file","originFileObj","post","headers","then","response","success","doUpgrade","catch","error","config_system_update","result","code","console","log","key","loading","content","setTimeout","duration","background","color","span","offset"],"sources":["/home/iam/Documents/network/src/components/antd/system/upfirmware/upload.tsx"],"sourcesContent":["\nimport { message as antdMessage, Form, Button, message, Upload, Card } from 'antd'\n\nimport axios from \"axios\"\nimport ubusApi from 'service/api/ubus-api'\nimport { UploadOutlined } from '@ant-design/icons';\nimport React from 'react';\n\nimport { useTranslation } from \"react-i18next\";\nimport \"../../../../translations/i18n\";\n  \nexport const UploadFirmware = (props: any) => {\n    const { t } = useTranslation();\n    const [form] = Form.useForm()\n    const [do_upgrade, setDoUpgrade] = React.useState(false)\n\n    let tokenString = sessionStorage.getItem('token');\n\n    const URL = \"/cgi-bin/luci-upload\"\n\n    const uploadFile = async (values: any) => {\n    \n        const data = new FormData();\n        values.token = tokenString;\n        data.append(\"sessionid\", values.token)\n        data.append(\"filename\", \"/tmp/firmware.bin\")\n        data.append(\"filedata\", values.imageFile.file.originFileObj)\n        axios.post(URL, data, {\n            headers: {\n                \"Content-Type\": \"multipart/form-data\"\n            }\n        }).then(response => {\n            message.success(t(\"upload_success\"));\n            doUpgrade()\n        }).catch(error => {            \n            message.error(t(\"fail\"));\n        })\n    }\n\n    const doUpgrade = async () => {\n        let result = await ubusApi.config_system_update()\n\n        const { code } = result\n        console.log('upgrade', code)\n\n        const key = 'updatable';\n        antdMessage.loading({ content: t(\"loading\"), key });\n        setTimeout(() => {\n            if (code == 1 || code == 2) \n            antdMessage.error({ content: t(\"invalid_firmware\"), key, duration: 2 });\n            else \n                antdMessage.success({ content: t(\"upgrade_success\"), key, duration: 2 });\n        }, 5000);\n    }\n\n    return (\n        <Card title={t(\"update_firmware\")} type=\"inner\" headStyle={{ background: \"linear-gradient(109.6deg, rgb(44, 83, 131), rgb(44, 83, 131) 18.9%, rgb(68, 124, 143), rgb(44, 83, 131) 91.1%, rgb(44, 83, 131))\",color: 'white'}}>\n        <Form\n            form={form}\n            labelCol={{ span: 10 }}\n            wrapperCol={{ span: 24 }}\n            onFinish={uploadFile}\n        >\n\n            <Form.Item label={t(\"choose_firmware\")} name=\"imageFile\">\n                <Upload maxCount={1} {...props}>\n                    <Button icon={<UploadOutlined />} onClick={uploadFile}>{t(\"upload\")}</Button>\n                </Upload>\n\n            </Form.Item>\n            <Form.Item wrapperCol={{ offset: 10, span: 24 }}>\n                <Button type='primary' htmlType=\"submit\">\n                    {t(\"update\")}\n                </Button>\n            </Form.Item>\n        </Form>\n        </Card>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}