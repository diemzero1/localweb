{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { deepMix, get, isArray, isEqual } from '@antv/util';\nimport { animation, interaction, scale, theme, tooltip } from '../../adaptor/common';\nimport { schema as schemaGeometry } from '../../adaptor/geometries';\nimport { deepAssign, findGeometry, flow, getAdjustAppendPadding, LEVEL, log, normalPadding, resolveAllPadding, transformLabel } from '../../utils';\nimport { ID_FIELD } from './constant';\nimport './interactions';\nimport './label';\nimport './shape';\nimport { getColorMap, islegalSets, layoutVennData } from './utils';\n/** 图例默认预留空间 */\nexport var LEGEND_SPACE = 40;\n/**\n * 获取 color 映射\n */\nfunction colorMap(params, data, colorPalette) {\n  var chart = params.chart,\n    options = params.options;\n  var blendMode = options.blendMode,\n    setsField = options.setsField;\n  var _a = chart.getTheme(),\n    colors10 = _a.colors10,\n    colors20 = _a.colors20;\n  var palette = colorPalette;\n  if (!isArray(palette)) {\n    palette = data.filter(function (d) {\n      return d[setsField].length === 1;\n    }).length <= 10 ? colors10 : colors20;\n  }\n  var map = getColorMap(palette, data, blendMode, setsField);\n  return function (id) {\n    return map.get(id) || palette[0];\n  };\n}\n/**\n * color options 转换\n */\nfunction transformColor(params, data) {\n  var options = params.options;\n  var color = options.color;\n  if (typeof color !== 'function') {\n    var colorPalette = typeof color === 'string' ? [color] : color;\n    var map_1 = colorMap(params, data, colorPalette);\n    return function (datum) {\n      return map_1(datum[ID_FIELD]);\n    };\n  }\n  return color;\n}\n/**\n * 处理 padding\n */\nfunction padding(params) {\n  var chart = params.chart,\n    options = params.options;\n  var legend = options.legend,\n    appendPadding = options.appendPadding,\n    padding = options.padding;\n  // 处理 legend 的位置. 默认预留 40px, 业务上可以通过 appendPadding 增加\n  var tempPadding = normalPadding(appendPadding);\n  if (legend !== false) {\n    tempPadding = getAdjustAppendPadding(appendPadding, get(legend, 'position'), LEGEND_SPACE);\n  }\n  chart.appendPadding = resolveAllPadding([tempPadding, padding]);\n  return params;\n}\n/**\n * 处理非法数据\n * @param params\n */\nfunction data(params) {\n  var options = params.options;\n  /* 如遇到 交集 中存在 非法元素 的情况，就过滤掉\n   * 如：\n   * data = [\n   *   { sets: ['A'], size: 3 }, // 集合\n   *   { sets: ['B'], size: 4 }, // 集合\n   *   { sets: ['A', 'B'], size: 2 }, // 交集\n   *   { sets: ['A', 'B', 'C'], size: 2 }, // 交集 (存在非法 C，过滤该条数据)\n   *   ...\n   * ]\n   */\n  var data = options['data'];\n  if (!data) {\n    log(LEVEL.WARN, false, 'warn: %s', '数据不能为空');\n    data = [];\n  }\n  // 合法元素的集合：['A', 'B']\n  var currSets = data.filter(function (datum) {\n    return datum.sets.length === 1;\n  }).map(function (datum) {\n    return datum.sets[0];\n  });\n  // 过滤 data\n  var filterSets = data.filter(function (datum) {\n    var sets = datum.sets;\n    // 存在非法元素，就过滤这条数据\n    return islegalSets(currSets, sets);\n  });\n  if (!isEqual(filterSets, data)) log(LEVEL.WARN, false, 'warn: %s', '交集中不能出现不存在的集合, 请输入合法数据');\n  return deepMix({}, params, {\n    options: {\n      data: filterSets\n    }\n  });\n}\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var pointStyle = options.pointStyle,\n    setsField = options.setsField,\n    sizeField = options.sizeField;\n  // 获取容器大小\n  var _a = normalPadding(chart.appendPadding),\n    t = _a[0],\n    r = _a[1],\n    b = _a[2],\n    l = _a[3];\n  // 处理 legend 的位置. 默认预留 40px, 业务上可以通过 appendPadding 增加\n  var customInfo = {\n    offsetX: l,\n    offsetY: t\n  };\n  // coordinateBBox + appendPadding = viewBBox, 不需要再计算 appendPadding 部分，因此直接使用 viewBBox\n  var _b = chart.viewBBox,\n    width = _b.width,\n    height = _b.height;\n  // 处理padding输入不合理的情况， w 和 h 不能为负数\n  var vennData = layoutVennData(options, Math.max(width - (r + l), 0), Math.max(height - (t + b), 0), 0);\n  chart.data(vennData);\n  var ext = schemaGeometry(deepAssign({}, params, {\n    options: {\n      xField: 'x',\n      yField: 'y',\n      sizeField: sizeField,\n      seriesField: ID_FIELD,\n      rawFields: [setsField, sizeField],\n      schema: {\n        shape: 'venn',\n        style: pointStyle\n      }\n    }\n  })).ext;\n  var geometry = ext.geometry;\n  geometry.customInfo(customInfo);\n  var colorOptions = transformColor(params, vennData);\n  // 韦恩图试点, color 通道只能映射一个字段. 通过外部查找获取 datum\n  if (typeof colorOptions === 'function') {\n    geometry.color(ID_FIELD, function (id) {\n      var datum = vennData.find(function (d) {\n        return d[ID_FIELD] === id;\n      });\n      var defaultColor = colorMap(params, vennData)(id);\n      return colorOptions(datum, defaultColor);\n    });\n  }\n  return params;\n}\n/**\n * 处理 label\n * @param params\n */\nfunction label(params) {\n  var chart = params.chart,\n    options = params.options;\n  var label = options.label;\n  // 获取容器大小\n  var _a = normalPadding(chart.appendPadding),\n    t = _a[0],\n    l = _a[3];\n  // 传入 label 布局函数所需的 自定义参数\n  var customLabelInfo = {\n    offsetX: l,\n    offsetY: t\n  };\n  var geometry = findGeometry(chart, 'schema');\n  if (!label) {\n    geometry.label(false);\n  } else {\n    var callback = label.callback,\n      cfg = __rest(label, [\"callback\"]);\n    geometry.label({\n      fields: ['id'],\n      callback: callback,\n      cfg: deepMix({}, transformLabel(cfg), {\n        // 使用 G2 的 自定义label 修改位置\n        type: 'venn',\n        customLabelInfo: customLabelInfo\n      })\n    });\n  }\n  return params;\n}\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params) {\n  var chart = params.chart,\n    options = params.options;\n  var legend = options.legend,\n    sizeField = options.sizeField;\n  chart.legend(ID_FIELD, legend);\n  // 强制不开启 连续图例\n  chart.legend(sizeField, false);\n  return params;\n}\n/**\n * 默认关闭坐标轴\n * @param params\n */\nexport function axis(params) {\n  var chart = params.chart;\n  chart.axis(false);\n  return params;\n}\n/**\n * 韦恩图 interaction 交互适配器\n */\nfunction vennInteraction(params) {\n  var options = params.options,\n    chart = params.chart;\n  var interactions = options.interactions;\n  if (interactions) {\n    var MAP_1 = {\n      'legend-active': 'venn-legend-active',\n      'legend-highlight': 'venn-legend-highlight'\n    };\n    interaction(deepAssign({}, params, {\n      options: {\n        interactions: interactions.map(function (i) {\n          return __assign(__assign({}, i), {\n            type: MAP_1[i.type] || i.type\n          });\n        })\n      }\n    }));\n  }\n  chart.removeInteraction('legend-active');\n  chart.removeInteraction('legend-highlight');\n  return params;\n}\n/**\n * 图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(padding, theme, data, geometry, label, scale({}), legend, axis, tooltip, vennInteraction, animation\n  // ... 其他的 adaptor flow\n  )(params);\n}","map":{"version":3,"mappings":"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","names":["deepMix","get","isArray","isEqual","animation","interaction","scale","theme","tooltip","schema","schemaGeometry","deepAssign","findGeometry","flow","getAdjustAppendPadding","LEVEL","log","normalPadding","resolveAllPadding","transformLabel","ID_FIELD","getColorMap","islegalSets","layoutVennData","LEGEND_SPACE","colorMap","params","data","colorPalette","options","setsField","chart","getTheme","colors10","colors20","palette","filter","d","length","map","blendMode","id","transformColor","color","map_1","datum","padding","appendPadding","tempPadding","legend","WARN","currSets","sets","filterSets","geometry","sizeField","t","r","b","l","customInfo","offsetX","offsetY","viewBBox","width","height","vennData","Math","max","xField","yField","seriesField","rawFields","shape","style","pointStyle","ext","colorOptions","find","defaultColor","label","customLabelInfo","cfg","fields","callback","type","axis","vennInteraction","interactions","MAP_1","i","removeInteraction","adaptor"],"sources":["/home/iam/Documents/network/node_modules/@antv/g2plot/src/plots/venn/adaptor.ts"],"sourcesContent":["import { Geometry } from '@antv/g2';\nimport { deepMix, get, isArray, isEqual } from '@antv/util';\nimport { animation, interaction, scale, theme, tooltip } from '../../adaptor/common';\nimport { schema as schemaGeometry } from '../../adaptor/geometries';\nimport { Params } from '../../core/adaptor';\nimport { Datum } from '../../types';\nimport {\n  deepAssign,\n  findGeometry,\n  flow,\n  getAdjustAppendPadding,\n  LEVEL,\n  log,\n  normalPadding,\n  resolveAllPadding,\n  transformLabel,\n} from '../../utils';\nimport { ID_FIELD } from './constant';\nimport './interactions';\nimport './label';\nimport './shape';\nimport { CustomInfo, VennData, VennOptions } from './types';\nimport { getColorMap, islegalSets, layoutVennData } from './utils';\n\n/** 图例默认预留空间 */\nexport const LEGEND_SPACE = 40;\n\n/**\n * 获取 color 映射\n */\nfunction colorMap(params: Params<VennOptions>, data: VennData, colorPalette?: string[]) {\n  const { chart, options } = params;\n  const { blendMode, setsField } = options;\n  const { colors10, colors20 } = chart.getTheme();\n  let palette = colorPalette;\n  if (!isArray(palette)) {\n    palette = data.filter((d) => d[setsField].length === 1).length <= 10 ? colors10 : colors20;\n  }\n  const map = getColorMap(palette, data, blendMode, setsField);\n\n  return (id: string) => map.get(id) || palette[0];\n}\n\n/**\n * color options 转换\n */\nfunction transformColor(params: Params<VennOptions>, data: VennData): VennOptions['color'] {\n  const { options } = params;\n  const { color } = options;\n\n  if (typeof color !== 'function') {\n    const colorPalette = typeof color === 'string' ? [color] : color;\n    const map = colorMap(params, data, colorPalette);\n    return (datum: Datum) => map(datum[ID_FIELD]);\n  }\n  return color;\n}\n\n/**\n * 处理 padding\n */\nfunction padding(params: Params<VennOptions>): Params<VennOptions> {\n  const { chart, options } = params;\n  const { legend, appendPadding, padding } = options;\n\n  // 处理 legend 的位置. 默认预留 40px, 业务上可以通过 appendPadding 增加\n  let tempPadding: number[] = normalPadding(appendPadding);\n  if (legend !== false) {\n    tempPadding = getAdjustAppendPadding(appendPadding, get(legend, 'position'), LEGEND_SPACE);\n  }\n\n  chart.appendPadding = resolveAllPadding([tempPadding, padding]);\n\n  return params;\n}\n\n/**\n * 处理非法数据\n * @param params\n */\nfunction data(params: Params<VennOptions>): Params<VennOptions> {\n  const { options } = params;\n\n  /* 如遇到 交集 中存在 非法元素 的情况，就过滤掉\n   * 如：\n   * data = [\n   *   { sets: ['A'], size: 3 }, // 集合\n   *   { sets: ['B'], size: 4 }, // 集合\n   *   { sets: ['A', 'B'], size: 2 }, // 交集\n   *   { sets: ['A', 'B', 'C'], size: 2 }, // 交集 (存在非法 C，过滤该条数据)\n   *   ...\n   * ]\n   */\n\n  let data = options['data'];\n  if (!data) {\n    log(LEVEL.WARN, false, 'warn: %s', '数据不能为空');\n    data = [];\n  }\n\n  // 合法元素的集合：['A', 'B']\n  const currSets = data.filter((datum) => datum.sets.length === 1).map((datum) => datum.sets[0]);\n  // 过滤 data\n  const filterSets = data.filter((datum) => {\n    const sets = datum.sets;\n    // 存在非法元素，就过滤这条数据\n    return islegalSets(currSets, sets);\n  });\n\n  if (!isEqual(filterSets, data)) log(LEVEL.WARN, false, 'warn: %s', '交集中不能出现不存在的集合, 请输入合法数据');\n\n  return deepMix({}, params, {\n    options: {\n      data: filterSets,\n    },\n  });\n}\n\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params: Params<VennOptions>): Params<VennOptions> {\n  const { chart, options } = params;\n  const { pointStyle, setsField, sizeField } = options;\n\n  // 获取容器大小\n  const [t, r, b, l] = normalPadding(chart.appendPadding);\n  // 处理 legend 的位置. 默认预留 40px, 业务上可以通过 appendPadding 增加\n  const customInfo: CustomInfo = { offsetX: l, offsetY: t };\n  // coordinateBBox + appendPadding = viewBBox, 不需要再计算 appendPadding 部分，因此直接使用 viewBBox\n  const { width, height } = chart.viewBBox;\n  // 处理padding输入不合理的情况， w 和 h 不能为负数\n  const vennData: VennData = layoutVennData(options, Math.max(width - (r + l), 0), Math.max(height - (t + b), 0), 0);\n  chart.data(vennData);\n\n  const { ext } = schemaGeometry(\n    deepAssign({}, params, {\n      options: {\n        xField: 'x',\n        yField: 'y',\n        sizeField: sizeField,\n        seriesField: ID_FIELD,\n        rawFields: [setsField, sizeField],\n        schema: {\n          shape: 'venn',\n          style: pointStyle,\n        },\n      },\n    })\n  );\n\n  const geometry = ext.geometry as Geometry;\n  geometry.customInfo(customInfo);\n\n  const colorOptions = transformColor(params, vennData);\n  // 韦恩图试点, color 通道只能映射一个字段. 通过外部查找获取 datum\n  if (typeof colorOptions === 'function') {\n    geometry.color(ID_FIELD, (id) => {\n      const datum = vennData.find((d) => d[ID_FIELD] === id);\n      const defaultColor = colorMap(params, vennData)(id);\n      return colorOptions(datum, defaultColor);\n    });\n  }\n\n  return params;\n}\n\n/**\n * 处理 label\n * @param params\n */\nfunction label(params: Params<VennOptions>): Params<VennOptions> {\n  const { chart, options } = params;\n  const { label } = options;\n\n  // 获取容器大小\n  const [t, , , l] = normalPadding(chart.appendPadding);\n  // 传入 label 布局函数所需的 自定义参数\n  const customLabelInfo = { offsetX: l, offsetY: t };\n\n  const geometry = findGeometry(chart, 'schema');\n\n  if (!label) {\n    geometry.label(false);\n  } else {\n    const { callback, ...cfg } = label;\n    geometry.label({\n      fields: ['id'],\n      callback,\n      cfg: deepMix({}, transformLabel(cfg), {\n        // 使用 G2 的 自定义label 修改位置\n        type: 'venn',\n        customLabelInfo,\n      }),\n    });\n  }\n\n  return params;\n}\n\n/**\n * legend 配置\n * @param params\n */\nexport function legend(params: Params<VennOptions>): Params<VennOptions> {\n  const { chart, options } = params;\n  const { legend, sizeField } = options;\n\n  chart.legend(ID_FIELD, legend);\n  // 强制不开启 连续图例\n  chart.legend(sizeField, false);\n\n  return params;\n}\n\n/**\n * 默认关闭坐标轴\n * @param params\n */\nexport function axis(params: Params<VennOptions>): Params<VennOptions> {\n  const { chart } = params;\n  chart.axis(false);\n\n  return params;\n}\n\n/**\n * 韦恩图 interaction 交互适配器\n */\nfunction vennInteraction(params: Params<VennOptions>): Params<VennOptions> {\n  const { options, chart } = params;\n  const { interactions } = options;\n\n  if (interactions) {\n    const MAP = {\n      'legend-active': 'venn-legend-active',\n      'legend-highlight': 'venn-legend-highlight',\n    };\n    interaction(\n      deepAssign({}, params, {\n        options: {\n          interactions: interactions.map((i) => ({\n            ...i,\n            type: MAP[i.type] || i.type,\n          })),\n        },\n      })\n    );\n  }\n\n  chart.removeInteraction('legend-active');\n  chart.removeInteraction('legend-highlight');\n  return params;\n}\n\n/**\n * 图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<VennOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(\n    padding,\n    theme,\n    data,\n    geometry,\n    label,\n    scale({}),\n    legend,\n    axis,\n    tooltip,\n    vennInteraction,\n    animation\n    // ... 其他的 adaptor flow\n  )(params);\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}