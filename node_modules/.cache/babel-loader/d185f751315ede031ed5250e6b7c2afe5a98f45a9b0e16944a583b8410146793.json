{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { get, isNumber, isObject, isUndefined, reduce } from '@antv/util';\nimport { LEVEL, log } from '../../utils';\nimport { ABSOLUTE_FIELD, DIFF_FIELD, IS_TOTAL, Y_FIELD } from './constant';\n/**\n * @desc 数据处理函数，统一将数据处理成[start, end]\n * @param data\n * @param xField\n * @param yField\n * @param totalLabel\n */\nexport function processData(data, xField, yField, newYField, total) {\n  var _a;\n  var newData = [];\n  reduce(data, function (r, d) {\n    var _a;\n    // 校验数据合法性\n    log(LEVEL.WARN, isNumber(d[yField]), d[yField] + \" is not a valid number\");\n    var value = isUndefined(d[yField]) ? null : d[yField];\n    newData.push(__assign(__assign({}, d), (_a = {}, _a[newYField] = [r, r + value], _a)));\n    return r + value;\n  }, 0);\n  // 如果需要展示总和\n  if (newData.length && total) {\n    var sum = get(newData, [[data.length - 1], newYField, [1]]);\n    newData.push((_a = {}, _a[xField] = total.label, _a[yField] = sum, _a[newYField] = [0, sum], _a));\n  }\n  return newData;\n}\n/**\n * 处理为 瀑布图 数据\n */\nexport function transformData(data, xField, yField, total) {\n  var processed = processData(data, xField, yField, Y_FIELD, total);\n  return processed.map(function (d, dIdx) {\n    var _a;\n    if (!isObject(d)) {\n      return d;\n    }\n    return __assign(__assign({}, d), (_a = {}, _a[ABSOLUTE_FIELD] = d[Y_FIELD][1], _a[DIFF_FIELD] = d[Y_FIELD][1] - d[Y_FIELD][0], _a[IS_TOTAL] = dIdx === data.length, _a));\n  });\n}","map":{"version":3,"mappings":";AAAA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,MAAM,QAAQ,YAAY;AAEzE,SAASC,KAAK,EAAEC,GAAG,QAAQ,aAAa;AACxC,SAASC,cAAc,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,OAAO,QAAQ,YAAY;AAE1E;;;;;;;AAOA,OAAM,SAAUC,WAAW,CACzBC,IAAqB,EACrBC,MAAc,EACdC,MAAc,EACdC,SAAiB,EACjBC,KAAkC;;EAElC,IAAMC,OAAO,GAAG,EAAE;EAClBb,MAAM,CACJQ,IAAI,EACJ,UAACM,CAAC,EAAEC,CAAC;;IACH;IACAb,GAAG,CAACD,KAAK,CAACe,IAAI,EAAEnB,QAAQ,CAACkB,CAAC,CAACL,MAAM,CAAC,CAAC,EAAKK,CAAC,CAACL,MAAM,CAAC,2BAAwB,CAAC;IAC1E,IAAMO,KAAK,GAAGlB,WAAW,CAACgB,CAAC,CAACL,MAAM,CAAC,CAAC,GAAG,IAAI,GAAGK,CAAC,CAACL,MAAM,CAAC;IACvDG,OAAO,CAACK,IAAI,uBAAMH,CAAC,gBAAGJ,SAAS,IAAG,CAACG,CAAC,EAAEA,CAAC,GAAGG,KAAK,CAAC,OAAG;IAEnD,OAAOH,CAAC,GAAGG,KAAK;EAClB,CAAC,EACD,CAAC,CACF;EACD;EACA,IAAIJ,OAAO,CAACM,MAAM,IAAIP,KAAK,EAAE;IAC3B,IAAMQ,GAAG,GAAGxB,GAAG,CAACiB,OAAO,EAAE,CAAC,CAACL,IAAI,CAACW,MAAM,GAAG,CAAC,CAAC,EAAER,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IAC7DE,OAAO,CAACK,IAAI,WACVG,GAACZ,MAAM,IAAGG,KAAK,CAACU,KAAK,EACrBD,GAACX,MAAM,IAAGU,GAAG,EACbC,GAACV,SAAS,IAAG,CAAC,CAAC,EAAES,GAAG,CAAC,MACrB;;EAEJ,OAAOP,OAAO;AAChB;AAEA;;;AAGA,OAAM,SAAUU,aAAa,CAC3Bf,IAAqB,EACrBC,MAAc,EACdC,MAAc,EACdE,KAAkC;EAElC,IAAMY,SAAS,GAAGjB,WAAW,CAACC,IAAI,EAAEC,MAAM,EAAEC,MAAM,EAAEJ,OAAO,EAAEM,KAAK,CAAC;EACnE,OAAOY,SAAS,CAACC,GAAG,CAAC,UAACV,CAAC,EAAEW,IAAI;;IAC3B,IAAI,CAAC5B,QAAQ,CAACiB,CAAC,CAAC,EAAE;MAChB,OAAOA,CAAC;;IAEV,6BACKA,CAAC,gBACHZ,cAAc,IAAGY,CAAC,CAACT,OAAO,CAAC,CAAC,CAAC,CAAC,KAC9BF,UAAU,IAAGW,CAAC,CAACT,OAAO,CAAC,CAAC,CAAC,CAAC,GAAGS,CAAC,CAACT,OAAO,CAAC,CAAC,CAAC,CAAC,KAC1CD,QAAQ,IAAGqB,IAAI,KAAKlB,IAAI,CAACW,MAAM;EAEpC,CAAC,CAAC;AACJ","names":["get","isNumber","isObject","isUndefined","reduce","LEVEL","log","ABSOLUTE_FIELD","DIFF_FIELD","IS_TOTAL","Y_FIELD","processData","data","xField","yField","newYField","total","newData","r","d","WARN","value","push","length","sum","_a","label","transformData","processed","map","dIdx"],"sources":["/home/iam/Documents/network/node_modules/@antv/g2plot/src/plots/waterfall/utils.ts"],"sourcesContent":["import { get, isNumber, isObject, isUndefined, reduce } from '@antv/util';\nimport { Options } from '../../types';\nimport { LEVEL, log } from '../../utils';\nimport { ABSOLUTE_FIELD, DIFF_FIELD, IS_TOTAL, Y_FIELD } from './constant';\n\n/**\n * @desc 数据处理函数，统一将数据处理成[start, end]\n * @param data\n * @param xField\n * @param yField\n * @param totalLabel\n */\nexport function processData(\n  data: Options['data'],\n  xField: string,\n  yField: string,\n  newYField: string,\n  total?: false | { label?: string }\n) {\n  const newData = [];\n  reduce(\n    data,\n    (r, d) => {\n      // 校验数据合法性\n      log(LEVEL.WARN, isNumber(d[yField]), `${d[yField]} is not a valid number`);\n      const value = isUndefined(d[yField]) ? null : d[yField];\n      newData.push({ ...d, [newYField]: [r, r + value] });\n\n      return r + value;\n    },\n    0\n  );\n  // 如果需要展示总和\n  if (newData.length && total) {\n    const sum = get(newData, [[data.length - 1], newYField, [1]]);\n    newData.push({\n      [xField]: total.label,\n      [yField]: sum,\n      [newYField]: [0, sum],\n    });\n  }\n  return newData;\n}\n\n/**\n * 处理为 瀑布图 数据\n */\nexport function transformData(\n  data: Options['data'],\n  xField: string,\n  yField: string,\n  total?: false | { label?: string }\n) {\n  const processed = processData(data, xField, yField, Y_FIELD, total);\n  return processed.map((d, dIdx) => {\n    if (!isObject(d)) {\n      return d;\n    }\n    return {\n      ...d,\n      [ABSOLUTE_FIELD]: d[Y_FIELD][1],\n      [DIFF_FIELD]: d[Y_FIELD][1] - d[Y_FIELD][0],\n      [IS_TOTAL]: dIdx === data.length,\n    };\n  });\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}