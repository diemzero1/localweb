{"ast":null,"code":"import _regeneratorRuntime from\"/home/iam/Documents/LocalWeb-master/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/iam/Documents/LocalWeb-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/iam/Documents/LocalWeb-master/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Form,Input,Button,message,Select,Switch,Card}from'antd';import React from'react';import ubusApi from'service/api/ubus-api';import{useTranslation}from\"react-i18next\";import\"../../../../translations/i18n\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var MeshTable=function MeshTable(){var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var pattern=/^[a-zA-Z0-9_.]+$/;var _useTranslation=useTranslation(),t=_useTranslation.t;var _React$useState=React.useState(true),_React$useState2=_slicedToArray(_React$useState,2),loading=_React$useState2[0],setLoading=_React$useState2[1];setTimeout(function(){setLoading(false);},1000);var loadPWD=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var result,mode_mesh;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ubusApi.show_network_wireless();case 2:result=_context.sent;_context.next=5;return ubusApi.show_mesh_config();case 5:mode_mesh=_context.sent;if(mode_mesh['enabled_mode']==\"controller\"){form.setFieldsValue({enabled:true,mode:\"controller\",ssid:result['values']['ssid'],key:result['values']['key']});}else if(mode_mesh['enabled_mode']==\"agent\"){form.setFieldsValue({enabled:true,mode:\"agent\",ssid:result['values']['ssid'],key:result['values']['key']});}else{form.setFieldsValue({enabled:false,ssid:result['values']['ssid'],key:result['values']['key']});}case 7:case\"end\":return _context.stop();}}},_callee);}));return function loadPWD(){return _ref.apply(this,arguments);};}();React.useEffect(function(){loadPWD();},[]);var onFinish=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(values){var paramContro,paramAgent,key;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:message.info(t('Please_wait_for_configuration'));if(!(values.mode==\"controller\")){_context2.next=8;break;}_context2.next=4;return ubusApi.config_mesh_controller(values.enabled.toString(),values.ssid,values.key);case 4:paramContro=_context2.sent;console.log(\"controller\",paramContro);_context2.next=12;break;case 8:_context2.next=10;return ubusApi.config_mesh_agent(values.enabled.toString());case 10:paramAgent=_context2.sent;console.log(\"agent\",paramAgent);case 12:key='updatable';message.loading({content:t('loading'),key:key});setTimeout(function(){message.success({content:t('success'),key:key,duration:2});},1000);setTimeout(function(){window.location.reload();},1500);case 16:case\"end\":return _context2.stop();}}},_callee2);}));return function onFinish(_x){return _ref2.apply(this,arguments);};}();var _React$useState3=React.useState(''),_React$useState4=_slicedToArray(_React$useState3,2),value=_React$useState4[0],setValue=_React$useState4[1];var handleChange=function handleChange(value){return setValue(value);};var _React$useState5=React.useState(''),_React$useState6=_slicedToArray(_React$useState5,2),value1=_React$useState6[0],setValue1=_React$useState6[1];var handleChange1=function handleChange1(value1){return setValue1(value1);};return/*#__PURE__*/_jsx(Form,{form:form,labelCol:{span:6},wrapperCol:{span:16},onFinish:onFinish,children:/*#__PURE__*/_jsxs(Card,{loading:loading,children:[/*#__PURE__*/_jsx(Form.Item,{label:t(\"status\"),valuePropName:\"checked\",name:\"enabled\",children:/*#__PURE__*/_jsx(Switch,{onChange:handleChange1})}),/*#__PURE__*/_jsx(Form.Item,{noStyle:true,shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.gender!==currentValues.gender;},children:function children(_ref3){var getFieldValue=_ref3.getFieldValue;return getFieldValue('enabled')==true?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Form.Item,{label:t(\"mode\"),name:\"mode\",rules:[{required:true,message:\"\"}],children:/*#__PURE__*/_jsx(Select,{defaultValue:\"Select Mode\",onChange:handleChange,options:[{value:\"agent\",label:\"Agent\"},{value:\"controller\",label:\"Controller\"}]})}),/*#__PURE__*/_jsx(Form.Item,{noStyle:true,shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.gender!==currentValues.gender;},children:function children(_ref4){var getFieldValue=_ref4.getFieldValue;return getFieldValue('mode')==\"agent\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Form.Item,{label:t(\"mesh_ssid\"),name:\"ssid\",children:/*#__PURE__*/_jsx(Input,{disabled:true})}),/*#__PURE__*/_jsx(Form.Item,{label:t(\"wpa_passphrase\"),name:\"key\",children:/*#__PURE__*/_jsx(Input.Password,{disabled:true})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Form.Item,{label:t(\"mesh_ssid\"),name:\"ssid\",rules:[{required:true,message:String(t(\"error_fill\"))},{validator:function validator(_,value){return pattern.test(value)?Promise.resolve():Promise.reject(t('White_space_and_special_characters_are_not_valid'));}}],children:/*#__PURE__*/_jsx(Input,{})}),/*#__PURE__*/_jsx(Form.Item,{label:t(\"wpa_passphrase\"),name:\"key\",rules:[{required:true,min:8,message:String(t(\"Password_must_be_minimum_8_characters\"))}],children:/*#__PURE__*/_jsx(Input.Password,{})})]});}})]}):null;}}),/*#__PURE__*/_jsx(Form.Item,{wrapperCol:{offset:6,span:16},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",children:t(\"submit\")})})]})});};","map":{"version":3,"names":["Form","Input","Button","message","Select","Switch","Card","React","ubusApi","useTranslation","MeshTable","useForm","form","pattern","t","useState","loading","setLoading","setTimeout","loadPWD","show_network_wireless","result","show_mesh_config","mode_mesh","setFieldsValue","enabled","mode","ssid","key","useEffect","onFinish","values","info","config_mesh_controller","toString","paramContro","console","log","config_mesh_agent","paramAgent","content","success","duration","window","location","reload","value","setValue","handleChange","value1","setValue1","handleChange1","span","prevValues","currentValues","gender","getFieldValue","required","label","String","validator","_","test","Promise","resolve","reject","min","offset"],"sources":["/home/iam/Documents/LocalWeb-master/src/components/antd/network/mesh/mesh.tsx"],"sourcesContent":["import { DeleteOutlined, EditOutlined } from '@ant-design/icons'\nimport { message as antdMessage, Form, Input, Button, message, Select, Switch, Checkbox, Card } from 'antd'\nimport { CheckboxChangeEvent } from 'antd/es/checkbox';\nimport React, { useRef, useState } from 'react'\nimport ubusApi from 'service/api/ubus-api';\nimport { useTranslation } from \"react-i18next\";\nimport \"../../../../translations/i18n\";\n\n\nexport const MeshTable = () => {\n    const [form] = Form.useForm()\n    let pattern = /^[a-zA-Z0-9_.]+$/\n    const { t } = useTranslation()\n    const [loading, setLoading] = React.useState(true)\n    setTimeout(() => {\n        setLoading(false)\n    }, 1000);\n    const loadPWD = async () => {\n        const result = await ubusApi.show_network_wireless()\n        const mode_mesh = await ubusApi.show_mesh_config()\n\n        if (mode_mesh['enabled_mode'] == \"controller\") {\n            form.setFieldsValue({ enabled: true, mode: \"controller\", ssid: result['values']['ssid'], key: result['values']['key'] })\n        } else if (mode_mesh['enabled_mode'] == \"agent\") {\n            form.setFieldsValue({ enabled: true, mode: \"agent\", ssid: result['values']['ssid'], key: result['values']['key'] })\n        } else {\n            form.setFieldsValue({ enabled: false, ssid: result['values']['ssid'], key: result['values']['key'] })\n        }\n    }\n    React.useEffect(() => { loadPWD() }, [])\n\n    const onFinish = async (values: any) => {\n        message.info(t('Please_wait_for_configuration'))\n        if (values.mode == \"controller\") {\n            const paramContro = await ubusApi.config_mesh_controller(values.enabled.toString(), values.ssid, values.key)\n            console.log(\"controller\", paramContro)\n        } else {\n            const paramAgent = await ubusApi.config_mesh_agent(values.enabled.toString())\n            console.log(\"agent\", paramAgent)\n        }\n        const key = 'updatable';\n        message.loading({ content: t('loading'), key });\n        setTimeout(() => {\n            message.success({ content: t('success'), key, duration: 2 });\n        }, 1000);\n        setTimeout(() => {\n            window.location.reload()\n        }, 1500);\n\n    }\n    const [value, setValue] = React.useState('')\n    const handleChange = (value: any) => setValue(value)\n    const [value1, setValue1] = React.useState('')\n    const handleChange1 = (value1: any) => setValue1(value1)\n    return (\n        <Form\n            form={form}\n            labelCol={{ span: 6 }}\n            wrapperCol={{ span: 16 }}\n            onFinish={onFinish}\n        >\n            <Card loading={loading}>\n                <Form.Item label={t(\"status\")} valuePropName=\"checked\" name=\"enabled\">\n                    <Switch onChange={handleChange1} />\n                </Form.Item>\n                <Form.Item\n                    noStyle\n                    shouldUpdate={(prevValues, currentValues) => prevValues.gender !== currentValues.gender}\n                >\n                    {\n                        ({ getFieldValue }) =>\n                            getFieldValue('enabled') ==\n                                true ? (\n                                <>\n                                    <Form.Item label={t(\"mode\")} name=\"mode\" rules={[{ required: true, message: \"\" }]}\n                                    >\n                                        <Select\n                                            defaultValue=\"Select Mode\"\n                                            onChange={handleChange}\n                                            options={[\n                                                {\n                                                    value: \"agent\",\n                                                    label: \"Agent\"\n                                                },\n                                                {\n                                                    value: \"controller\",\n                                                    label: \"Controller\"\n                                                },\n                                            ]}\n                                        ></Select>\n                                    </Form.Item>\n                                    <Form.Item\n                                        noStyle\n                                        shouldUpdate={(prevValues, currentValues) => prevValues.gender !== currentValues.gender}\n                                    >\n                                        {\n                                            ({ getFieldValue }) =>\n                                                getFieldValue('mode') ==\n                                                    \"agent\" ? (\n                                                    <>\n                                                        <Form.Item label={t(\"mesh_ssid\")} name=\"ssid\"\n                                                        >\n                                                            <Input disabled></Input>\n                                                        </Form.Item>\n                                                        <Form.Item label={t(\"wpa_passphrase\")} name=\"key\"\n                                                        >\n                                                            <Input.Password disabled></Input.Password>\n                                                        </Form.Item>\n                                                    </>\n                                                ) : (\n                                                    <>\n                                                        <Form.Item label={t(\"mesh_ssid\")} name=\"ssid\" \n                                                            rules={[\n                                                                { required: true, message: String(t(\"error_fill\")) },\n                                                                {\n                                                                    validator: (_, value) =>\n                                                                    pattern.test(value) ? Promise.resolve() : Promise.reject(t('White_space_and_special_characters_are_not_valid'))\n                                                                }\n                                                            ]}\n                                                        >\n                                                            <Input></Input>\n                                                        </Form.Item>\n                                                        <Form.Item label={t(\"wpa_passphrase\")} name=\"key\" rules={[{ required: true, min : 8, message: String(t(\"Password_must_be_minimum_8_characters\"))}]}\n                                                        >\n                                                            <Input.Password></Input.Password>\n                                                        </Form.Item>\n                                                    </>\n                                                )}\n                                    </Form.Item>\n                                </>\n                            ) : null}\n                </Form.Item>\n                <Form.Item wrapperCol={{ offset: 6, span: 16 }}>\n                    <Button\n                        type='primary'\n                        htmlType=\"submit\"\n                    >\n                        {t(\"submit\")}\n                    </Button>\n                </Form.Item>\n            </Card>\n        </Form>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}