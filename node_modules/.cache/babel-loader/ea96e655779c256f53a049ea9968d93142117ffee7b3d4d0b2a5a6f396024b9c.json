{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { each } from '@antv/util';\nimport TransformAction from './scale-transform';\n/**\n * 拖拽 Scale 的 Action\n * @ignore\n */\nvar ScaleTranslate = /** @class */function (_super) {\n  __extends(ScaleTranslate, _super);\n  function ScaleTranslate() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.startPoint = null;\n    _this.starting = false;\n    _this.startCache = {};\n    return _this;\n  }\n  /**\n   * 开始\n   */\n  ScaleTranslate.prototype.start = function () {\n    var _this = this;\n    this.startPoint = this.context.getCurrentPoint();\n    this.starting = true;\n    var dims = this.dims;\n    each(dims, function (dim) {\n      var scale = _this.getScale(dim);\n      var min = scale.min,\n        max = scale.max,\n        values = scale.values;\n      _this.startCache[dim] = {\n        min: min,\n        max: max,\n        values: values\n      };\n    });\n  };\n  // 平移分类的度量\n  // private translateCategory(dim, scale, normalPoint) {\n  // }\n  /**\n   * 结束\n   */\n  ScaleTranslate.prototype.end = function () {\n    this.startPoint = null;\n    this.starting = false;\n    this.startCache = {};\n  };\n  /**\n   * 平移\n   */\n  ScaleTranslate.prototype.translate = function () {\n    var _this = this;\n    if (!this.starting) {\n      return;\n    }\n    var startPoint = this.startPoint;\n    var coord = this.context.view.getCoordinate();\n    var currentPoint = this.context.getCurrentPoint();\n    var normalStart = coord.invert(startPoint);\n    var noramlCurrent = coord.invert(currentPoint);\n    var dx = noramlCurrent.x - normalStart.x;\n    var dy = noramlCurrent.y - normalStart.y;\n    var view = this.context.view;\n    var dims = this.dims;\n    each(dims, function (dim) {\n      _this.translateDim(dim, {\n        x: dx * -1,\n        y: dy * -1\n      });\n    });\n    view.render(true);\n  };\n  // 平移度量\n  ScaleTranslate.prototype.translateDim = function (dim, normalPoint) {\n    if (this.hasDim(dim)) {\n      var scale = this.getScale(dim);\n      if (scale.isLinear) {\n        this.translateLinear(dim, scale, normalPoint);\n      }\n      //  else { // 暂时仅处理连续字段\n      // this.translateCategory(dim, scale, normalPoint);\n      // }\n    }\n  };\n  // linear 度量平移\n  ScaleTranslate.prototype.translateLinear = function (dim, scale, normalPoint) {\n    var view = this.context.view;\n    var _a = this.startCache[dim],\n      min = _a.min,\n      max = _a.max;\n    var range = max - min;\n    var d = normalPoint[dim] * range;\n    // 只有第一次缓存，否则无法回滚\n    if (!this.cacheScaleDefs[dim]) {\n      this.cacheScaleDefs[dim] = {\n        // @ts-ignore\n        nice: scale.nice,\n        min: min,\n        max: max\n      };\n    }\n    view.scale(scale.field, {\n      // @ts-ignore\n      nice: false,\n      min: min + d,\n      max: max + d\n    });\n  };\n  // 平移分类的度量\n  // private translateCategory(dim, scale, normalPoint) {\n  // }\n  /**\n   * 回滚\n   */\n  ScaleTranslate.prototype.reset = function () {\n    _super.prototype.reset.call(this);\n    this.startPoint = null;\n    this.starting = false;\n  };\n  return ScaleTranslate;\n}(TransformAction);\nexport default ScaleTranslate;","map":{"version":3,"mappings":"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","names":["each","TransformAction","__extends","_this","ScaleTranslate","startPoint","context","getCurrentPoint","starting","dims","dim","scale","getScale","max","values","startCache","min","coord","view","getCoordinate","currentPoint","normalStart","invert","noramlCurrent","dx","x","dy","y","translateDim","render","normalPoint","hasDim","isLinear","translateLinear","range","d","cacheScaleDefs","nice","field","_super","reset"],"sources":["/home/iam/Documents/network/node_modules/@antv/g2/src/interaction/action/view/scale-translate.ts"],"sourcesContent":["import { each } from '@antv/util';\nimport { Point } from '../../../dependents';\nimport TransformAction from './scale-transform';\n\n/**\n * 拖拽 Scale 的 Action\n * @ignore\n */\nclass ScaleTranslate extends TransformAction {\n  protected startPoint: Point = null;\n  protected starting = false;\n  private startCache = {};\n  /**\n   * 开始\n   */\n  public start() {\n    this.startPoint = this.context.getCurrentPoint();\n    this.starting = true;\n    const dims = this.dims;\n    each(dims, (dim) => {\n      const scale = this.getScale(dim);\n      const { min, max, values } = scale;\n      this.startCache[dim] = { min, max, values };\n    });\n  }\n\n  // 平移分类的度量\n  // private translateCategory(dim, scale, normalPoint) {\n  // }\n\n  /**\n   * 结束\n   */\n  public end() {\n    this.startPoint = null;\n    this.starting = false;\n    this.startCache = {};\n  }\n\n  /**\n   * 平移\n   */\n  public translate() {\n    if (!this.starting) {\n      return;\n    }\n    const startPoint = this.startPoint;\n    const coord = this.context.view.getCoordinate();\n    const currentPoint = this.context.getCurrentPoint();\n    const normalStart = coord.invert(startPoint);\n    const noramlCurrent = coord.invert(currentPoint);\n    const dx = noramlCurrent.x - normalStart.x;\n    const dy = noramlCurrent.y - normalStart.y;\n    const view = this.context.view;\n    const dims = this.dims;\n    each(dims, (dim) => {\n      this.translateDim(dim, { x: dx * -1, y: dy * -1 });\n    });\n    view.render(true);\n  }\n\n  // 平移度量\n  private translateDim(dim, normalPoint) {\n    if (this.hasDim(dim)) {\n      const scale = this.getScale(dim);\n      if (scale.isLinear) {\n        this.translateLinear(dim, scale, normalPoint);\n      }\n      //  else { // 暂时仅处理连续字段\n      // this.translateCategory(dim, scale, normalPoint);\n      // }\n    }\n  }\n  // linear 度量平移\n  private translateLinear(dim, scale, normalPoint) {\n    const view = this.context.view;\n    const { min, max } = this.startCache[dim];\n    const range = max - min;\n    const d = normalPoint[dim] * range;\n    // 只有第一次缓存，否则无法回滚\n    if (!this.cacheScaleDefs[dim]) {\n      this.cacheScaleDefs[dim] = {\n        // @ts-ignore\n        nice: scale.nice,\n        min,\n        max,\n      };\n    }\n    view.scale(scale.field, {\n      // @ts-ignore\n      nice: false,\n      min: min + d,\n      max: max + d,\n    });\n  }\n\n  // 平移分类的度量\n  // private translateCategory(dim, scale, normalPoint) {\n  // }\n\n  /**\n   * 回滚\n   */\n  public reset() {\n    super.reset();\n    this.startPoint = null;\n    this.starting = false;\n  }\n}\n\nexport default ScaleTranslate;\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}