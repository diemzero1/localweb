{"ast":null,"code":"import _regeneratorRuntime from\"/home/iam/Documents/network/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/iam/Documents/network/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from'react';import{useDispatch,useSelector}from'react-redux';import{sessionActions,sessionSelector}from'../redux/reducer/sessionSlice';import ubusApi from'../service/api/ubus-api';/**\n * Headless component keeping session alive by periodically calling ubus\n * @param {*} props\n * @returns\n */export var SessionKeepAlive=function SessionKeepAlive(props){var _props$interval=props.interval,interval=_props$interval===void 0?10:_props$interval;var dispatch=useDispatch();var _useSelector=useSelector(sessionSelector),session=_useSelector.session;var beatFunc=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(sessionActions.keepAliveBeat());updateSystemInfo();case 2:case\"end\":return _context.stop();}}},_callee);}));return function beatFunc(){return _ref.apply(this,arguments);};}();var updateSystemInfo=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var result;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return ubusApi.systemInfo();case 2:result=_context2.sent;if((result===null||result===void 0?void 0:result.code)===0){dispatch(sessionActions.updateSystemInfo(result===null||result===void 0?void 0:result.data));}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function updateSystemInfo(){return _ref2.apply(this,arguments);};}();React.useEffect(function(){var handle=setInterval(beatFunc,interval*1000);return function(){return clearInterval(handle);};},[]);React.useEffect(function(){beatFunc();},[session]);return null;};","map":{"version":3,"names":["React","useDispatch","useSelector","sessionActions","sessionSelector","ubusApi","SessionKeepAlive","props","interval","dispatch","session","beatFunc","keepAliveBeat","updateSystemInfo","systemInfo","result","code","data","useEffect","handle","setInterval","clearInterval"],"sources":["/home/iam/Documents/network/src/components/keep-alive.tsx"],"sourcesContent":["import React from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { sessionActions, sessionSelector } from '../redux/reducer/sessionSlice'\nimport ubusApi from '../service/api/ubus-api'\n\n/**\n * Headless component keeping session alive by periodically calling ubus\n * @param {*} props\n * @returns\n */\nexport const SessionKeepAlive = (props:any) => {\n  const { interval = 10 } = props\n  const dispatch = useDispatch()\n  const { session } = useSelector(sessionSelector)\n  const beatFunc = async () => {\n    dispatch(sessionActions.keepAliveBeat())\n    updateSystemInfo()\n  }\n  const updateSystemInfo = async () => {\n    const result = await ubusApi.systemInfo()\n    if (result?.code === 0) {\n      dispatch(sessionActions.updateSystemInfo(result?.data))\n    }\n  }\n  React.useEffect(() => {\n    const handle = setInterval(beatFunc, interval * 1000)\n    return () => clearInterval(handle)\n  }, [])\n\n  React.useEffect(() => {\n    beatFunc()\n  }, [session])\n  return null\n}\n"],"mappings":"kPAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,OAASC,cAAc,CAAEC,eAAe,KAAQ,+BAA+B,CAC/E,MAAOC,QAAO,KAAM,yBAAyB,CAE7C;AACA;AACA;AACA;AACA,GACA,MAAO,IAAMC,iBAAgB,CAAG,QAAnBA,iBAAgB,CAAIC,KAAS,CAAK,CAC7C,oBAA0BA,KAAK,CAAvBC,QAAQ,CAARA,QAAQ,0BAAG,EAAE,iBACrB,GAAMC,SAAQ,CAAGR,WAAW,EAAE,CAC9B,iBAAoBC,WAAW,CAACE,eAAe,CAAC,CAAxCM,OAAO,cAAPA,OAAO,CACf,GAAMC,SAAQ,4FAAG,qIACfF,QAAQ,CAACN,cAAc,CAACS,aAAa,EAAE,CAAC,CACxCC,gBAAgB,EAAE,uDACnB,kBAHKF,SAAQ,0CAGb,CACD,GAAME,iBAAgB,6FAAG,4KACFR,QAAO,CAACS,UAAU,EAAE,QAAnCC,MAAM,gBACZ,GAAI,CAAAA,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEC,IAAI,IAAK,CAAC,CAAE,CACtBP,QAAQ,CAACN,cAAc,CAACU,gBAAgB,CAACE,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEE,IAAI,CAAC,CAAC,CACzD,CAAC,wDACF,kBALKJ,iBAAgB,2CAKrB,CACDb,KAAK,CAACkB,SAAS,CAAC,UAAM,CACpB,GAAMC,OAAM,CAAGC,WAAW,CAACT,QAAQ,CAAEH,QAAQ,CAAG,IAAI,CAAC,CACrD,MAAO,kBAAMa,cAAa,CAACF,MAAM,CAAC,GACpC,CAAC,CAAE,EAAE,CAAC,CAENnB,KAAK,CAACkB,SAAS,CAAC,UAAM,CACpBP,QAAQ,EAAE,CACZ,CAAC,CAAE,CAACD,OAAO,CAAC,CAAC,CACb,MAAO,KAAI,CACb,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}